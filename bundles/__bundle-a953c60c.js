/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},n.apply(this,arguments)};function r(e,t,n,r){return new(n||(n=Promise))((function(i,s){function a(e){try{u(r.next(e))}catch(e){s(e)}}function o(e){try{u(r.throw(e))}catch(e){s(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,o)}u((r=r.apply(e,t||[])).next())}))}function i(e,t){var n,r,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,s=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=s.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}function o(e,t,n){if(n||2===arguments.length)for(var r,i=0,s=t.length;i<s;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var u,c="4.0.0-beta-3",l=function(){function e(){}return Object.defineProperty(e,"OS_VERSION",{get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_VERSION",{get:function(){return"4.0.0-beta-3"},enumerable:!1,configurable:!0}),Object.defineProperty(e,"SDK_MAJOR_VERSION",{get:function(){return e.SDK_VERSION.split(".")[0]},enumerable:!1,configurable:!0}),Object.defineProperty(e,"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",{get:function(){return 100},enumerable:!1,configurable:!0}),Object.defineProperty(e,"INTERNAL_CALL",{get:function(){return"ic"},enumerable:!1,configurable:!0}),e}();!function(e){e[e.SESSION_KEY_EXPIRED=400302]="SESSION_KEY_EXPIRED",e[e.SESSION_TOKEN_EXPIRED=400309]="SESSION_TOKEN_EXPIRED",e[e.INTERNAL_SERVER_ERROR=500901]="INTERNAL_SERVER_ERROR",e[e.RATE_LIMIT_EXCEEDED=500910]="RATE_LIMIT_EXCEEDED",e[e.UNKNOWN_SERVER_ERROR=900200]="UNKNOWN_SERVER_ERROR",e[e.DEBUG_MODE_REQUIRED=7e5]="DEBUG_MODE_REQUIRED",e[e.LOST_INSTANCE=700100]="LOST_INSTANCE",e[e.INVALID_CONNECTION_STATE_TRANSITION=700200]="INVALID_CONNECTION_STATE_TRANSITION",e[e.INVALID_INITIALIZATION=800100]="INVALID_INITIALIZATION",e[e.CONNECTION_REQUIRED=800101]="CONNECTION_REQUIRED",e[e.CONNECTION_CANCELED=800102]="CONNECTION_CANCELED",e[e.INVALID_PARAMETER=800110]="INVALID_PARAMETER",e[e.NETWORK_ERROR=800120]="NETWORK_ERROR",e[e.NETWORK_ROUTING_ERROR=800121]="NETWORK_ROUTING_ERROR",e[e.MALFORMED_DATA=800130]="MALFORMED_DATA",e[e.MALFORMED_ERROR_DATA=800140]="MALFORMED_ERROR_DATA",e[e.WRONG_CHANNEL_TYPE=800150]="WRONG_CHANNEL_TYPE",e[e.MARK_AS_READ_RATE_LIMIT_EXCEEDED=800160]="MARK_AS_READ_RATE_LIMIT_EXCEEDED",e[e.QUERY_IN_PROGRESS=800170]="QUERY_IN_PROGRESS",e[e.ACK_TIMEOUT=800180]="ACK_TIMEOUT",e[e.LOGIN_TIMEOUT=800190]="LOGIN_TIMEOUT",e[e.WEBSOCKET_CONNECTION_CLOSED=800200]="WEBSOCKET_CONNECTION_CLOSED",e[e.WEBSOCKET_CONNECTION_FAILED=800210]="WEBSOCKET_CONNECTION_FAILED",e[e.REQUEST_FAILED=800220]="REQUEST_FAILED",e[e.FILE_UPLOAD_CANCEL_FAILED=800230]="FILE_UPLOAD_CANCEL_FAILED",e[e.REQUEST_CANCELED=800240]="REQUEST_CANCELED",e[e.REQUEST_DUPLICATED=800250]="REQUEST_DUPLICATED",e[e.FILE_SIZE_LIMIT_EXCEEDED=800260]="FILE_SIZE_LIMIT_EXCEEDED",e[e.SESSION_TOKEN_REQUEST_FAILED=800500]="SESSION_TOKEN_REQUEST_FAILED",e[e.SESSION_TOKEN_REFRESHED=800501]="SESSION_TOKEN_REFRESHED",e[e.SESSION_TOKEN_REFRESH_FAILED=800502]="SESSION_TOKEN_REFRESH_FAILED"}(u||(u={}));var h,d=function(e){return!(e instanceof p&&!e.shouldThrowOutside)},p=function(e){function n(t){var r=t.code,i=void 0===r?0:r,s=t.message,a=e.call(this,s)||this;return a.shouldThrowOutside=!1,a.name="SendbirdError",a.code=i,Object.setPrototypeOf(a,n.prototype),a}return t(n,e),Object.defineProperty(n.prototype,"isSessionTokenExpiredError",{get:function(){return this.code===u.SESSION_TOKEN_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isSessionKeyExpiredError",{get:function(){return this.code===u.SESSION_KEY_EXPIRED},enumerable:!1,configurable:!0}),Object.defineProperty(n,"debugModeRequired",{get:function(){return new n({code:u.DEBUG_MODE_REQUIRED,message:"Cannot run this operation in production mode."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"lostInstance",{get:function(){return new n({code:u.LOST_INSTANCE,message:"Instance ID is missing. It should belong to an instance."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidConnectionStateTransition",{get:function(){return new n({code:u.INVALID_CONNECTION_STATE_TRANSITION,message:"Invalid connection state transition."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionRequired",{get:function(){return new n({code:u.CONNECTION_REQUIRED,message:"Connection is required."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionCanceled",{get:function(){return new n({code:u.CONNECTION_CANCELED,message:"Connection is canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"invalidParameters",{get:function(){return new n({code:u.INVALID_PARAMETER,message:"Invalid parameters."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"networkError",{get:function(){return new n({code:u.NETWORK_ERROR,message:"There was a network error."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"markAsReadAllRateLimitExceeded",{get:function(){return new n({code:u.MARK_AS_READ_RATE_LIMIT_EXCEEDED,message:"markAsRead rate limit exceeded."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"queryInProgress",{get:function(){return new n({code:u.QUERY_IN_PROGRESS,message:"Query in progress."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"noAckTimeout",{get:function(){return new n({code:u.ACK_TIMEOUT,message:"Command received no ack."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"loginTimeout",{get:function(){return new n({code:u.LOGIN_TIMEOUT,message:"Connection timeout."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"connectionClosed",{get:function(){return new n({code:u.WEBSOCKET_CONNECTION_CLOSED,message:"Connection is closed. Please reconnect."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestFailed",{get:function(){return new n({code:u.REQUEST_FAILED,message:"Request failed."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"fileUploadCanceled",{get:function(){return new n({code:u.FILE_UPLOAD_CANCEL_FAILED,message:"File upload has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"requestCanceled",{get:function(){return new n({code:u.REQUEST_CANCELED,message:"Request has been canceled."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRefreshFailed",{get:function(){return new n({code:u.SESSION_TOKEN_REFRESH_FAILED,message:"Failed to refresh the session key."})},enumerable:!1,configurable:!0}),Object.defineProperty(n,"sessionTokenRequestFailed",{get:function(){return new n({code:u.SESSION_TOKEN_REQUEST_FAILED,message:"Failed to get the session token."})},enumerable:!1,configurable:!0}),n.prototype.throwOutside=function(){throw this.shouldThrowOutside=!0,this},n}(Error),f=[u.CONNECTION_REQUIRED,u.NETWORK_ERROR,u.ACK_TIMEOUT,u.WEBSOCKET_CONNECTION_CLOSED,u.WEBSOCKET_CONNECTION_FAILED,u.FILE_UPLOAD_CANCEL_FAILED,u.REQUEST_CANCELED,u.INTERNAL_SERVER_ERROR,u.RATE_LIMIT_EXCEEDED,u.UNKNOWN_SERVER_ERROR],_=[u.WEBSOCKET_CONNECTION_CLOSED,u.WEBSOCKET_CONNECTION_FAILED,u.CONNECTION_REQUIRED],g=function(e,t){if(e!==t){var r=n({},e),i=n({},t);return(!r.hasOwnProperty("messageId")||!i.hasOwnProperty("messageId")||r.messageId===i.messageId)&&((!r.hasOwnProperty("reqId")||!i.hasOwnProperty("reqId")||r.reqId===i.reqId)&&(r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,i.hasOwnProperty("messageId")&&delete i.messageId,i.hasOwnProperty("reqId")&&delete i.reqId,JSON.stringify(r)===JSON.stringify(i)))}return!0},y=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||("string"==typeof e?typeof t===e:m(e,t))},m=function(e,t){return Object.values(e).includes(t)},E=function(e,t,n){return void 0===n&&(n=!1),!(!n||null!=t)||Array.isArray(t)&&t.every((function(t){return y(e,t)}))},v=function(e){return e>0&&_.indexOf(e)>=0},T=function(e,t){if(void 0===t&&(t=!1),t&&null===e)return!0;var n=y("object",e)&&null!==e&&e.hasOwnProperty("name")&&"string"==typeof e.name&&e.hasOwnProperty("uri")&&"string"==typeof e.uri&&e.hasOwnProperty("type")&&"string"==typeof e.type;if(!n){if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n},S=function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=o([],a(e),!1).sort(),r=o([],a(t),!1).sort(),i=0;i<n.length;++i)if(n[i]!==r[i])return!1;return!0},I=function(){function e(e){var t=void 0===e?{}:e,n=t.useMemberAsMessageSender,r=void 0!==n&&n,i=t.typingIndicatorInvalidateTime,s=void 0===i?1e4:i,a=t.typingIndicatorThrottle,o=void 0===a?1e3:a,u=t.websocketResponseTimeout,c=void 0===u?1e4:u;this._useMemberAsMessageSender=!1,this._typingIndicatorInvalidateTime=1e4,this._typingIndicatorThrottle=1e3,this._websocketResponseTimeout=1e4,this._useMemberAsMessageSender=r,this._typingIndicatorInvalidateTime=s,this._typingIndicatorThrottle=o,this._websocketResponseTimeout=c}return Object.defineProperty(e.prototype,"useMemberAsMessageSender",{get:function(){return this._useMemberAsMessageSender},set:function(e){y("boolean",e)&&(this._useMemberAsMessageSender=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorInvalidateTime",{get:function(){return this._typingIndicatorInvalidateTime},set:function(e){y("number",e)&&(this._typingIndicatorInvalidateTime=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"typingIndicatorThrottle",{get:function(){return this._typingIndicatorThrottle},set:function(e){y("number",e)&&e>=1e3&&e<=9e3&&(this._typingIndicatorThrottle=e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"websocketResponseTimeout",{get:function(){return this._websocketResponseTimeout},set:function(e){y("number",e)&&e>=5e3&&e<=3e4&&(this._websocketResponseTimeout=e)},enumerable:!1,configurable:!0}),e}(),b={key:"__ev",value:{k:"__ev",v:"scs"},generation:1},O={encrypt:function(e){return e},decrypt:function(e){return e}},N=function(e){var t=e.encryption,n=void 0===t?null:t,r=e.store,i=void 0===r?null:r,s=e.localCacheEnabled,a=void 0===s||s;this.nestdb=null,this.store=i,this.encryption=null!=n?n:O,this.localCacheEnabled=a},A=function(){function e(){this.sessionKey=null,this.authToken=null}return Object.defineProperty(e.prototype,"hasSession",{get:function(){return!!this.sessionKey},enumerable:!1,configurable:!0}),e.prototype.clear=function(){this.authToken=null,this.sessionKey=null},e}(),w=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"===t?n:3&n|8).toString(16)}))},C=function(){function e(e){var t=e.container;this._container={},this._container=t,this.key=w()}return e.prototype._register=function(e,t,n){return e in this._container||(this._container[e]=new Map),this._container[e].set(this.key,{occurence:t,handler:n}),this},e.prototype.on=function(e,t){return this._register(e,-1,t)},e.prototype.once=function(e,t){return this._register(e,1,t)},e.prototype.close=function(){for(var e in this._container)this._container[e].delete(this.key)},e}(),R=function(){function e(){this._container={}}return e.prototype.on=function(e,t){return new C({container:this._container}).on(e,t)},e.prototype.once=function(e,t){return new C({container:this._container}).once(e,t)},e.prototype.dispatch=function(e,t){var n,r,i=this._container[e];if(i){var a=[];try{for(var o=s(i.keys()),u=o.next();!u.done;u=o.next()){var c=u.value,l=i.get(c);l.handler(t),l.occurence>0&&(l.occurence--,0===l.occurence&&a.push(c))}}catch(e){n={error:e}}finally{try{u&&!u.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}a.forEach((function(e){return i.delete(e)}))}},e}(),D=function(){function e(){this._dispatcher=new R}return e.prototype.on=function(e){return this._dispatcher.on("event",e)},e.prototype.once=function(e){return this._dispatcher.once("event",e)},e.prototype.dispatch=function(e){this._dispatcher.dispatch("event",e)},e}(),M=function(){},k=function(e){var t={};return e&&Object.keys(e).forEach((function(n){void 0!==e[n]&&NaN!==e[n]&&null!==e[n]&&(t[n]=e[n])})),t};!function(e){e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE"}(h||(h={}));var L,U=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.params={},t.requireAuth=!0,t.headers={},t.requestId=w(),t}return t(n,e),n.prototype.stringifyParams=function(e){return"object"!=typeof e||Array.isArray(e)?String(e):e?JSON.stringify(e):""},Object.defineProperty(n.prototype,"query",{get:function(){var e=this,t=k(this.params);return"?".concat(Object.keys(t).map((function(n){return"".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(e.stringifyParams(t[n])))})).join("&"))},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"payload",{get:function(){var e=this,t=k(this.params);if(Object.keys(t).some((function(e){return T(t[e])}))){var n=new FormData;return Object.keys(t).forEach((function(r){var i;if(t[r]instanceof Blob){var s=t[r];n.append(r,s,null!==(i=s.name)&&void 0!==i?i:"filename")}else n.append(r,e.stringifyParams(t[r]))})),n}return JSON.stringify(t)},enumerable:!1,configurable:!0}),n}(M),P=function(e){function r(t,n){var r=e.call(this)||this;return r._iid=t,r._payload=n,r}return t(r,e),Object.defineProperty(r.prototype,"payload",{get:function(){return n({},this._payload)},enumerable:!1,configurable:!0}),r.prototype.as=function(e){return new e(this._iid,this.payload)},r}(M),q=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(M),F=function(e){function n(t){var n=e.call(this)||this;return n.requestId=t,n}return t(n,e),n}(M),x=function(){function e(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,s=t.logger,a=this;this._abortControl=new Map,this._iid=e,this._auth=n,this._sdkState=r,this._dispatcher=i,this._dispatcher.on((function(e){e instanceof F&&a.cancel(e.requestId)})),this._logger=s}return Object.defineProperty(e.prototype,"_userAgentWithExtension",{get:function(){var e=this._sdkState.extensions,t=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",n=e.sb_uikit?"u".concat(e.sb_uikit):"";return"JS/c".concat(l.SDK_VERSION,"/").concat(t,"/").concat(n)},enumerable:!1,configurable:!0}),e.prototype._createHeader=function(e,t){void 0===t&&(t=null);var r=this._sdkState,i=r.appId,s=r.appVersion,a=n(n({},e.headers),{SendBird:"JS,".concat(l.OS_VERSION,",").concat(l.SDK_VERSION,",").concat(i).concat(s?",".concat(s):""),"SB-User-Agent":encodeURIComponent(this._userAgentWithExtension),"Request-Sent-Timestamp":Date.now().toString()});return t||(a["Content-Type"]="application/json; charset=utf-8"),e.requireAuth&&this._auth.hasSession&&(a["Session-Key"]=this._auth.sessionKey),this._auth&&this._auth.authToken&&(a["App-Id"]=i,a["Access-Token"]=this._auth.authToken),a},e.prototype.send=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,a,o,u,c,l,d,f,_,g,y;return i(this,(function(i){switch(i.label){case 0:t=e.path,n=e.method,r=![h.GET,h.DELETE].includes(n),s=this._sdkState.api,a="".concat(s.host).concat(t).concat(r?"":e.query),o=r?e.payload:null,u=this._createHeader(e,o instanceof FormData?o:null),c=new AbortController,l=c.signal,this._abortControl.set(e.requestId,c),i.label=1;case 1:return i.trys.push([1,4,,5]),[4,fetch(a,{method:n,body:o,headers:u,signal:l})];case 2:return[4,(d=i.sent()).json()];case 3:if(f=i.sent(),d.ok||d.redirected)return this._logger.debug("receive api response",e.requestId),[2,new P(this._iid,f)];throw f?((_=new p(f)).isSessionKeyExpiredError&&this._dispatcher.dispatch(new q),_):p.requestFailed;case 4:throw(g=i.sent())instanceof p?(this._logger.debug("fail api request",g),g):"AbortError"===g.name?p.requestCanceled:(y=p.networkError,this._logger.debug("fail api request",y),y);case 5:return[2]}}))}))},e.prototype.cancel=function(e){this._abortControl.has(e)&&(this._abortControl.get(e).abort(),this._abortControl.delete(e))},e.prototype.cancelAll=function(){var e,t;try{for(var n=s(this._abortControl.values()),r=n.next();!r.done;r=n.next()){r.value.abort()}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}this._abortControl.clear()},e}(),G=function(e){function n(t,n,r,i){void 0===i&&(i="");var s,a=this;return(a=e.call(this)||this)._iid=t,a.code=n,a.payload=r,a.requestId=r?null!==(s=r.req_id)&&void 0!==s?s:i:"",a}return t(n,e),n.createFromRawMessage=function(e,t){var r=t.substring(0,4),i=null;try{i=JSON.parse(t.substring(4))}catch(e){r="NOOP"}finally{return new n(e,r,i)}},n.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n.prototype.as=function(e){return new e(this._iid,this.code,this.payload)},n}(M),Q=function(e){function n(t){var n,r=t.code,i=t.ackRequired,s=t.payload,a=void 0===s?null:s,o=this;return(o=e.call(this)||this).code=r,o.payload=a,o.requestId=null!==(n=o.payload.req_id)&&void 0!==n?n:w(),o.ackRequired=i,o.payload.req_id=o.requestId,o}return t(n,e),n.prototype.convertToMessage=function(){return"".concat(this.code).concat(JSON.stringify(this.payload),"\n")},n}(M),j=function(e){function n(){return e.call(this,{code:"PING",payload:{id:Date.now(),active:1},ackRequired:!1})||this}return t(n,e),n}(Q),z=function(){function e(e){var t=e.pingDelegate,n=e.sdkState,r=e.logger;this._pingTimer=null,this._pingTimeoutTimer=null,this.pingDelegate=t,this.sdkState=n,this._logger=r}return Object.defineProperty(e.prototype,"isWaiting",{get:function(){return!!this._pingTimeoutTimer},enumerable:!1,configurable:!0}),e.prototype.ping=function(){var e,t=this,n=new j;try{var r=null!==(e=this.sdkState.websocket.pongTimeout)&&void 0!==e?e:5e3;this._pingTimeoutTimer=setTimeout((function(){t._logger.debug("pinger.ping() timeout"),t.pingDelegate.error(null)}),r),this.pingDelegate.send(n),this._logger.debug("pinger.ping()")}catch(e){this._logger.debug("pinger.ping() error",e),this.pingDelegate.error(null)}return n},e.prototype.pong=function(){this._logger.debug("pinger.pong()"),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},e.prototype.refreshTimer=function(){var e,t=this;this._logger.debug("pinger.refreshTimer()");var n=null!==(e=this.sdkState.websocket.pingInterval)&&void 0!==e?e:15e3;this.stop(),this._pingTimer=setInterval((function(){t.ping()}),n)},e.prototype.start=function(){this._logger.debug("pinger.start()"),this.refreshTimer(),this.ping()},e.prototype.stop=function(){this._logger.debug("pinger.stop()"),this._pingTimer&&(clearInterval(this._pingTimer),this._pingTimer=null),this._pingTimeoutTimer&&(clearTimeout(this._pingTimeoutTimer),this._pingTimeoutTimer=null)},e}(),K=function(){};!function(e){e.CONNECTING="CONNECTING",e.OPEN="OPEN",e.CLOSED="CLOSED"}(L||(L={}));var B,V=function(e){function n(t,n){var r=n.sdkState,i=n.dispatcher,s=n.logger,a=e.call(this)||this;return a._pinger=null,a.lastActive=0,a._iid=t,a._sdkState=r,a._dispatcher=i,a._logger=s,a._sdkState.websocket.pingerDisabled||(a._pinger=new z({pingDelegate:{send:function(e){return a.send(e)},error:function(e){return a.error(e)}},sdkState:a._sdkState,logger:s})),a}return t(n,e),Object.defineProperty(n.prototype,"connectionState",{get:function(){if(this._ws)switch(this._ws.readyState){case 0:return L.CONNECTING;case 1:return L.OPEN}return L.CLOSED},enumerable:!1,configurable:!0}),n.prototype.connect=function(e){var t=this;this._ws=new WebSocket(e),this._ws.onopen=function(){t._logger.debug("websocket open"),t.dispatch("open")},this._ws.onmessage=function(e){e.data.split("\n").forEach((function(e){if(e&&y("string",e)){var n=G.createFromRawMessage(t._iid,e);t._logger.debug("receive websocket event",n),"LOGI"===n.code?(n.payload&&!n.payload.error&&t._pinger&&t._pinger.start(),t.dispatch("message",n)):"PONG"===n.code?t._pinger&&t._pinger.pong():"EXPR"===n.code?n.payload&&n.payload.expires_in>0&&t._dispatcher.dispatch(new q):"NOOP"===n.code||t.dispatch("message",n)}}))},this._ws.onerror=function(){t._logger.debug("websocket error"),t._pinger&&t._pinger.stop(),t.dispatch("error",p.networkError)},this._ws.onclose=function(){t._logger.debug("websocket close"),t._pinger&&t._pinger.stop(),t.dispatch("close")},this.lastActive=Date.now()},n.prototype.disconnect=function(){var e=this;this._logger.debug("websocket disconnect"),this._pinger&&this._pinger.stop(),this._ws&&(this._ws.onopen=K,this._ws.onmessage=K,this._ws.onerror=K,this._ws.onclose=function(){e.dispatch("close")},this._ws.close(),this._ws=null)},n.prototype.send=function(e){if(!this._ws)throw p.connectionClosed;"PING"!==e.code?this._pinger&&this._pinger.refreshTimer():this._logger.debug("send ping",e),this._ws.send(e.convertToMessage())},n.prototype.error=function(e){this._logger.debug("websocket error",e),this._pinger&&this._pinger.stop(),this.dispatch("error",e)},n}(R),H=function(e){function n(t){var n=t.all,r=t.custom_types,i=t.ts,s=e.call(this)||this;return s.all=n,s.customTypes=r,s.ts=i,s}return t(n,e),n}(M),W=function(){var e=this;this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))},X=function(){function e(e,t){var n=t.auth,r=t.sdkState,i=t.dispatcher,s=t.logger,a=this;this._ackStateMap=new Map,this._sdkState=r,this._dispatcher=i,this._logger=s,this.apiClient=new x(e,{auth:n,sdkState:r,dispatcher:i,logger:s}),this.websocketClient=new V(e,{sdkState:r,dispatcher:i,logger:s}),this.websocketClient.on("message",(function(e){if(e.payload.unread_cnt&&a._dispatcher.dispatch(new H(e.payload.unread_cnt)),e.requestId){if(a._ackStateMap.has(e.requestId)){var t=a._ackStateMap.get(e.requestId);"EROR"!==e.code?t.resolve(e):t.reject(new p({code:e.payload.code,message:e.payload.message}))}}else a._dispatcher.dispatch(e)})).on("close",(function(){a._ackStateMap.forEach((function(e){e.reject(p.connectionClosed)})),a._ackStateMap.clear()}))}return e.prototype._sendApiRequest=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.apiClient.send(e)];case 1:return[2,t.sent()]}}))}))},e.prototype._sendWebsocketRequest=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s=this;return i(this,(function(i){if(t=new W,e.ackRequired){n=null,r=function(r,i){void 0===r&&(r=null),void 0===i&&(i=null),s._ackStateMap.has(e.requestId)&&(s._ackStateMap.delete(e.requestId),n&&(clearTimeout(n),n=null),r?(s._logger.debug("fail websocket request",r),t.reject(r)):(s._logger.debug("receive websocket ack",e.requestId),t.resolve(i)))};try{n=setTimeout((function(){return r(p.noAckTimeout)}),this._sdkState.websocket.responseTimeout),this._ackStateMap.set(e.requestId,{resolve:function(e){return r(null,e)},reject:function(e){return r(e)}}),this.websocketClient.send(e)}catch(e){r(e)}}else try{this.websocketClient.send(e),t.resolve(null)}catch(e){t.reject(e)}return[2,t.promise]}))}))},e.prototype.send=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e instanceof U?[4,this._sendApiRequest(e)]:[3,2];case 1:case 3:return[2,t.sent()];case 2:return e instanceof Q?[4,this._sendWebsocketRequest(e)]:[3,4];case 4:throw p.invalidParameters}}))}))},e.prototype.cancel=function(e){this.apiClient.cancel(e)},e.prototype.cancelAll=function(){this.apiClient.cancelAll()},e}();!function(e){e[e.NONE=0]="NONE",e[e.INITIALIZED=1]="INITIALIZED",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.RECONNECTING=4]="RECONNECTING",e[e.DISCONNECTED=5]="DISCONNECTED",e[e.LOGOUT=6]="LOGOUT"}(B||(B={}));var Y,J,Z,$,ee,te,ne,re,ie=function(e){function n(t){var n=t.stateType,r=e.call(this)||this;return r.stateType=n,r}return t(n,e),n}(M),se=function(){function e(e,t){var n=t.auth,s=t.sdkState,a=t.dispatcher,o=t.logger,u=this;this._currentConnectionStateType=B.INITIALIZED,this._lazyCallQueue=[],this.commandRouter=new X(e,{auth:n,sdkState:s,dispatcher:a,logger:o}),this._auth=n,this._logger=o,this._dispatcher=a,this._dispatcher.on((function(e){if(e instanceof ie){var t=e.stateType;switch(u._currentConnectionStateType=t,t){case B.CONNECTED:var n=u._lazyCallQueue;u._lazyCallQueue=[],n.forEach((function(e){return r(u,void 0,void 0,(function(){var t,n,r,s,a;return i(this,(function(i){switch(i.label){case 0:t=e.command,n=e.deferred,r=e.timeout,clearTimeout(r),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.send(t)];case 2:return s=i.sent(),n.resolve(s),[3,4];case 3:return a=i.sent(),n.reject(a),[3,4];case 4:return[2]}}))}))}));break;case B.INITIALIZED:case B.DISCONNECTED:case B.LOGOUT:n=u._lazyCallQueue;u._lazyCallQueue=[],n.forEach((function(e){return r(u,void 0,void 0,(function(){var t,n;return i(this,(function(r){return t=e.deferred,n=e.timeout,clearTimeout(n),this._auth&&this._auth.hasSession?t.reject(p.connectionClosed):t.reject(p.connectionRequired),[2]}))}))}))}}}))}return Object.defineProperty(e.prototype,"isReady",{get:function(){return this._currentConnectionStateType===B.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLazyCallActivated",{get:function(){return this._currentConnectionStateType===B.CONNECTING||this._currentConnectionStateType===B.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.send=function(e){return r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){switch(i.label){case 0:return e instanceof Q?this.isReady?(this._logger.debug("send websocket request",e),[4,this.commandRouter.send(e)]):[3,2]:[3,4];case 1:case 5:return[2,i.sent()];case 2:if(this.isLazyCallActivated)return this._logger.debug("wait websocket request",e),t=new W,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw this._logger.debug("fail websocket request"),p.connectionRequired;case 3:return[3,7];case 4:return e instanceof U?this._auth.hasSession?(this._logger.debug("send api request",e),[4,this.commandRouter.send(e)]):[3,6]:[3,7];case 6:if(this.isLazyCallActivated)return this._logger.debug("wait api request",e),t=new W,this._lazyCallQueue.push({command:e,deferred:t,timeout:setTimeout((function(){return r.timeout(e.requestId)}),1e4)}),[2,t.promise];throw n=p.connectionRequired,this._logger.debug("fail api request",n),n;case 7:return[2]}}))}))},e.prototype.forceSend=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._logger.debug("send websocket request (forced)",e),[4,this.commandRouter.send(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.timeout=function(e){this._logger.debug("timeout request",e);var t=this._lazyCallQueue.findIndex((function(t){return t.command.requestId===e}));t>-1&&(this._lazyCallQueue[t].deferred.reject(p.connectionRequired),this._lazyCallQueue.splice(t,1))},e.prototype.cancel=function(e){this._logger.debug("cancel api request",e),this.commandRouter.cancel(e)},e.prototype.cancelAll=function(){this._logger.debug("cancel all api requests"),this.commandRouter.cancelAll()},e}(),ae=function(e){function n(t){var n=t.userId,r=t.authToken,i=t.expiringSession,s=void 0===i||i,a=e.call(this)||this;return a.path="/users/".concat(n,"/session_key"),a.method=h.POST,a.params={token:r,expiring_session:!!s},a.requireAuth=!1,a}return t(n,e),n}(U),oe=function(e){function n(t){var n=t.authToken,r=t.expiringSession,i=void 0===r||r;return e.call(this,{code:"LOGI",payload:{token:n,expiring_session:i?1:0},ackRequired:!0})||this}return t(n,e),n}(Q),ue=function(e){function n(t,n){var r=e.call(this,t,n)||this,i=n.key;return r.key=i,r}return t(n,e),n}(P),ce=function(e){function n(t,n,r){var i=e.call(this,t,"LOGI",r)||this;return i.error=null,i.newKey=r.new_key,i.error=r.error?new p(r.error):null,i}return t(n,e),n}(G),le=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(M),he=function(e){return r(void 0,void 0,void 0,(function(){return i(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))},de=function(){function e(){}return e.prototype.calcTimeout=function(){return 0},e}(),pe=function(e,t,n){return void 0===n&&(n=new de),r(void 0,void 0,void 0,(function(){var r,s,a,o,u,c;return i(this,(function(i){switch(i.label){case 0:r=0,s=null,a=function(e){return void 0===e&&(e=null),s=null!=e?e:new Error("Halted")},o=function(){r=0},i.label=1;case 1:if(!(-1===t||r<t))return[3,9];i.label=2;case 2:return i.trys.push([2,4,,8]),[4,e(a,o)];case 3:if(u=i.sent(),s)throw s;return[2,u];case 4:if(c=i.sent(),s)return[3,6];if(++r===t)throw c;return[4,he(n.calcTimeout(r))];case 5:return i.sent(),[3,7];case 6:throw s;case 7:return[3,8];case 8:return[3,1];case 9:return[2]}}))}))},fe=function(e){return r(void 0,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return n.sent(),[3,3];case 2:if(!((t=n.sent())instanceof p))throw t;return t.throwOutside(),[3,3];case 3:return[2]}}))}))},_e=function(e){return r(void 0,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e()];case 1:case 2:return t.sent(),[3,3];case 3:return[2]}}))}))},ge=function(){function e(e){var t=e.auth,n=e.sdkState,r=e.dispatcher,i=e.requestQueue,s=e.logger,a=this;this._currentConnectionStateType=B.INITIALIZED,this.auth=t,this._sdkState=n,this._dispatcher=r,this._requestQueue=i,this._logger=s,this._dispatcher.on((function(e){if(e instanceof ie){var t=e.stateType;a._currentConnectionStateType=t}else e instanceof q&&a.refresh()}))}return e.prototype.createRefreshWebsocketCommand=function(e){return new oe({authToken:e,expiringSession:!0})},e.prototype._refreshSessionKey=function(e,t){return r(this,void 0,void 0,(function(){var n,s,a,o,u,c,l,h=this;return i(this,(function(f){switch(f.label){case 0:if(this._currentConnectionStateType!==B.CONNECTED)return[3,4];f.label=1;case 1:return f.trys.push([1,3,,4]),n=this.createRefreshWebsocketCommand(e),[4,this._requestQueue.forceSend(n)];case 2:if(s=f.sent(),a=s.as(ce),o=a.newKey,u=a.error)throw u;return this.auth.sessionKey=null!=o?o:this.auth.sessionKey,this._logger.debug("session refreshed"),fe((function(){return r(h,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionRefreshed(),[2]}))}))})),t&&t.resolve(),[2];case 3:if(c=f.sent(),d(c))throw c;return c.isSessionTokenExpiredError?(this._handleError(t),[2]):[3,4];case 4:return f.trys.push([4,6,,7]),l=new ae({userId:this._sdkState.userId,authToken:e,expiringSession:!0}),[4,pe((function(e){return r(h,void 0,void 0,(function(){var t,n,r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._requestQueue.forceSend(l)];case 1:return t=i.sent(),n=t.as(ue).key,this.auth.sessionKey=n,[3,3];case 2:throw(r=i.sent()).isSessionTokenExpiredError&&e(p.sessionTokenRefreshFailed),r;case 3:return[2]}}))}))}),3)];case 5:return f.sent(),this._logger.debug("session refreshed"),[3,7];case 6:return f.sent(),this._handleError(t),[2];case 7:return fe((function(){return r(h,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionRefreshed(),[2]}))}))})),t&&t.resolve(),[2]}}))}))},e.prototype._handleError=function(e){var t=this,n=p.sessionTokenRefreshFailed;fe((function(){return r(t,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionError(n),[2]}))}))})),e&&e.reject(n)},e.prototype.refresh=function(){return r(this,void 0,void 0,(function(){var e,t,n,s=this;return i(this,(function(a){return this.handler?(e=new W,t=function(t){t?(s._logger.debug("session refreshing.."),s.auth.authToken=t,s._refreshSessionKey(t,e)):(s._logger.debug("session closed"),fe((function(){return r(s,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionClosed(),[2]}))}))})),e.resolve())},n=function(){s._dispatcher.dispatch(new le);var t=p.sessionTokenRequestFailed;s.handler&&(fe((function(){return r(s,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionError(t),[2]}))}))})),e.reject(t))},this._logger.debug("session expired"),this.handler.onSessionExpired(),this.auth.authToken?this._refreshSessionKey(this.auth.authToken,e):fe((function(){return r(s,void 0,void 0,(function(){return i(this,(function(e){return this.handler.onSessionTokenRequired(t,n),[2]}))}))})),[2,e.promise]):[2]}))}))},e}(),ye=function(){function e(){this.type=B.NONE,this.name="none"}return e.prototype.run=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2]}))}))},e.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2]}))}))},e.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2]}))}))},e.prototype.onDisconnect=function(e,t){return t.error,t.autoReconnect,r(this,void 0,void 0,(function(){return i(this,(function(e){return[2]}))}))},e.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2]}))}))},e}(),me=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=B.LOGOUT,t.name="logout",t}return t(n,e),n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n=this;return i(this,(function(s){switch(s.label){case 0:return t=e.sdkState.userId,e.logout(),fe((function(){return r(n,void 0,void 0,(function(){return i(this,(function(n){return e.connectionHandlers.forEach((function(e){e.onDisconnected(t)})),[2]}))}))})),[4,e.changeState(new Ie)];case 1:return s.sent(),[2]}}))}))},n}(ye),Ee=function(e){function n(t){var n=t.autoReconnect,r=e.call(this)||this;return r.type=B.DISCONNECTED,r.name="disconnected",r._autoReconnect=!1,r._autoReconnect=n,r}return t(n,e),n.prototype.run=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.disconnect(),this._autoReconnect?[4,e.changeState(new ve)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return e.disconnect(),[4,e.changeState(new Se({authToken:t}))];case 1:return n.sent(),[2]}}))}))},n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new ve)];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new me)];case 1:return t.sent(),[2]}}))}))},n}(ye),ve=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=B.RECONNECTING,t.name="reconnecting",t._haltConnect=null,t._resetConnect=null,t._callbacks=[],t}return t(n,e),n.prototype.flushCallbacks=function(e){void 0===e&&(e=null),this._callbacks.forEach((function(t){return t(e)}))},n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n,s,a,o,c=this;return i(this,(function(l){switch(l.label){case 0:t=new W,this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),fe((function(){return r(c,void 0,void 0,(function(){return i(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectStarted()})),[2]}))}))})),l.label=1;case 1:return l.trys.push([1,4,,8]),n=e.sdkState.websocket,s=n.reconnectMaxRetry,a=n.reconnectRetryStrategy,[4,pe((function(t,n){return r(c,void 0,void 0,(function(){var r;return i(this,(function(i){switch(i.label){case 0:this._haltConnect=t,this._resetConnect=n,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.connect()];case 2:return i.sent(),[3,4];case 3:if((r=i.sent())instanceof p&&r.code===u.CONNECTION_CANCELED)return t(r),[2];throw r;case 4:return[2]}}))}))}),s,a)];case 2:return l.sent(),[4,e.changeState(new Te)];case 3:return l.sent(),fe((function(){return r(c,void 0,void 0,(function(){return i(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectSucceeded()})),this.flushCallbacks(null),[2]}))}))})),[3,8];case 4:return o=l.sent(),d(o)?[3,6]:[4,e.changeState(new Ee({autoReconnect:!1}))];case 5:return l.sent(),fe((function(){return r(c,void 0,void 0,(function(){return i(this,(function(t){return e.connectionHandlers.forEach((function(e){e.onReconnectFailed()})),this.flushCallbacks(o),[2]}))}))})),[3,7];case 6:throw o;case 7:return[3,8];case 8:return[2,t.promise]}}))}))},n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){return e=new W,this._resetConnect&&this._resetConnect(),this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){return e=new W,this._resetConnect&&this._resetConnect(),this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onDisconnect=function(e,t){var n=t.error,s=void 0===n?null:n,a=t.autoReconnect,o=void 0===a||a;return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(null!=s?s:p.connectionCanceled),[4,e.changeState(new Ee({autoReconnect:o}))];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,e.changeState(new me)];case 1:return t.sent(),[2]}}))}))},n}(ye),Te=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=B.CONNECTED,t.name="connected",t}return t(n,e),n.prototype.onReconnect=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return e.disconnect(),[4,e.changeState(new ve)];case 1:return t.sent(),[2]}}))}))},n.prototype.onDisconnect=function(e,t){var n=t.autoReconnect;return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new Ee({autoReconnect:n}))];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,e.changeState(new me)];case 1:return t.sent(),[2]}}))}))},n}(ye),Se=function(e){function n(t){var n=t.authToken,r=e.call(this)||this;return r.type=B.CONNECTING,r.name="connecting",r._authToken="",r._haltConnect=null,r._callbacks=[],r._authToken=n,r}return t(n,e),n.prototype.flushCallbacks=function(e){void 0===e&&(e=null),this._callbacks.forEach((function(t){return t(e)}))},n.prototype.run=function(e){return r(this,void 0,void 0,(function(){var t,n,s,a=this;return i(this,(function(o){switch(o.label){case 0:t=new W,this._callbacks.push((function(e){return e?t.reject(e):t.resolve()})),n=null,o.label=1;case 1:return o.trys.push([1,4,8,9]),[4,pe((function(t){return r(a,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:this._haltConnect=t,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.connect(this._authToken)];case 2:return r.sent(),[3,4];case 3:if((n=r.sent())instanceof p&&n.code===u.CONNECTION_CANCELED)return t(n),[2];throw n;case 4:return[2]}}))}))}),e.sdkState.websocket.connectMaxRetry)];case 2:return o.sent(),[4,e.changeState(new Te)];case 3:return o.sent(),[3,9];case 4:return s=o.sent(),d(s)?[3,6]:(n=s,e.disconnect(),[4,e.changeState(new Ie)]);case 5:return o.sent(),[3,7];case 6:throw s;case 7:return[3,9];case 8:return fe((function(){return r(a,void 0,void 0,(function(){return i(this,(function(t){return n||e.connectionHandlers.forEach((function(t){t.onConnected(e.sdkState.userId)})),this.flushCallbacks(n),[2]}))}))})),[7];case 9:return[2,t.promise]}}))}))},n.prototype.onConnect=function(e){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){return e=new W,this._callbacks.push((function(t){return t?e.reject(t):e.resolve()})),[2,e.promise]}))}))},n.prototype.onDisconnect=function(e,t){var n=t.error,s=void 0===n?null:n;return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(null!=s?s:p.connectionCanceled),[4,e.changeState(new me)];case 1:return t.sent(),[2]}}))}))},n.prototype.onLogout=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._haltConnect&&this._haltConnect(p.connectionCanceled),[4,e.changeState(new me)];case 1:return t.sent(),[2]}}))}))},n}(ye),Ie=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=B.INITIALIZED,t.name="initialized",t}return t(n,e),n.prototype.onConnect=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,e.changeState(new Se({authToken:t}))];case 1:return n.sent(),[2]}}))}))},n}(ye),be=function(e){void 0===e&&(e={}),this.emojiHash=e.emoji_hash||"",this.uploadSizeLimit=e.file_upload_size_limit?1048576*e.file_upload_size_limit:Number.MAX_VALUE,this.useReaction=!!e.use_reaction,this.applicationAttributes=e.application_attributes||[],this.premiumFeatureList=e.premium_feature_list||[]},Oe=new Map,Ne=function(e,t){var n;return void 0===t&&(t=null),null!==t&&Oe.set(e,t),null!==(n=Oe.get(e))&&void 0!==n?n:""},Ae=function(){function e(e){this._iid="",this._iid=e}return e.payloadify=function(e){return e?k({_iid:e._iid}):null},e}(),we="/".concat("v3","/users"),Ce="/".concat("v3","/storage/file"),Re="/".concat("v3","/group_channels"),De="/".concat("v3","/sdk/group_channels"),Me="/".concat("v3","/open_channels"),ke="/".concat("v3","/sdk/open_channels"),Le="/".concat("v3","/search"),Ue="/".concat("v3","/report"),Pe="/".concat("v3","/emojis"),qe="/".concat("v3","/emoji_categories"),Fe=function(e){function n(t){var n=t.userId,r=t.metadata,i=e.call(this)||this;return i.method=h.POST,i.path="".concat(we,"/").concat(n,"/metadata"),i.params={metadata:r},i}return t(n,e),n}(U);!function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}t(n,e)}(P),function(e){e.BASE="base",e.GROUP="group",e.OPEN="open"}(Y||(Y={})),function(e){e.OPERATOR="operator",e.NONE="none"}(J||(J={})),function(e){e.BASE="base",e.USER="user",e.FILE="file",e.ADMIN="admin"}(Z||(Z={})),function(e){e.ALL="",e.USER="MESG",e.FILE="FILE",e.ADMIN="ADMM"}($||($={})),function(e){e.USERS="users",e.CHANNEL="channel"}(ee||(ee={})),function(e){e.ALL="all",e.NONE="none",e.ONLY_REPLY_TO_CHANNEL="only_reply_to_channel"}(te||(te={})),function(e){e.DEFAULT="default",e.SUPPRESS="suppress"}(ne||(ne={})),function(e){e.PENDING="pending",e.FAILED="failed",e.CANCELED="canceled",e.SUCCEEDED="succeeded"}(re||(re={}));var xe=function(e){switch(e){case Y.GROUP:return Re;case Y.OPEN:return Me;default:return null}},Ge=function(e){switch(e){case Y.GROUP:return"".concat(Ue,"/group_channels");case Y.OPEN:return"".concat(Ue,"/open_channels");default:return null}},Qe=function(e,t,n){var r,i;switch(e){case ee.CHANNEL:return!0;case ee.USERS:try{for(var a=s(t),o=a.next();!o.done;o=a.next()){if(o.value===n)return!0}}catch(e){r={error:e}}finally{try{o&&!o.done&&(i=a.return)&&i.call(a)}finally{if(r)throw r.error}}}return!1},je=function(e,t,n){var r=Qe(e.mentionType,e.mentionedUserIds,n),i=Qe(t.mentionType,t.mentionedUserIds,n);return!r&&i?1:r&&!i?-1:0},ze=function(e){function n(t){var n=this,r=t.channelUrl,i=t.channelType,s=t.metadata;return(n=e.call(this)||this).method=h.POST,n.path="".concat(xe(i),"/").concat(encodeURIComponent(r),"/metadata"),n.params={metadata:s,include_ts:!0},n}return t(n,e),n}(U),Ke=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metaData=null!=n?n:{},r}return t(n,e),n}(P),Be=function(e){function n(t){var n=t.userId,r=t.metadata,i=t.upsert,s=e.call(this)||this;return s.method=h.PUT,s.path="".concat(we,"/").concat(n,"/metadata"),s.params={metadata:r,upsert:i},s}return t(n,e),n}(U),Ve=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.metadata=n,r}return t(n,e),n}(P),He=function(e){function n(t){var n=t.userId,r=t.metadataKey,i=e.call(this)||this;return i.method=h.DELETE,i.path="".concat(we,"/").concat(n,"/metadata/").concat(r),i}return t(n,e),n}(U);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(P);var We=function(e){function n(t){var n=t.userId,r=e.call(this)||this;return r.method=h.DELETE,r.path="".concat(we,"/").concat(n,"/metadata"),r}return t(n,e),n}(U);!function(e){function n(){return null!==e&&e.apply(this,arguments)||this}t(n,e)}(P);var Xe,Ye=function(e,t){void 0===t&&(t=null);var n=JSON.parse(JSON.stringify(e));return t&&t(n),n},Je=function(e,t){void 0===t&&(t=null);var n=JSON.parse(JSON.stringify(e));return t&&t(n),n},Ze=function(e){return{do:function(t){e||t()},throw:function(t){if(!e)throw t}}};!function(e){e.ONLINE="online",e.OFFLINE="offline",e.NON_AVAILABLE="nonavailable"}(Xe||(Xe={}));var $e,et=function(e){function s(t,n){var r,i,s,u,c,l,h,d,p,f,_,g,E=this;return(E=e.call(this,t)||this).userId=null!==(i=null!==(r=n.guest_id)&&void 0!==r?r:n.user_id)&&void 0!==i?i:"",E.nickname=null!==(u=null!==(s=n.nickname)&&void 0!==s?s:n.name)&&void 0!==u?u:"",E.plainProfileUrl=null!==(l=null!==(c=n.profile_url)&&void 0!==c?c:n.image)&&void 0!==l?l:"",E.requireAuth=null!==(h=n.require_auth_for_profile_image)&&void 0!==h&&h,E.metaData=null!==(d=n.metadata)&&void 0!==d?d:{},E.connectionStatus=Xe.NON_AVAILABLE,m(Xe,n.is_online)?E.connectionStatus=n.is_online:y("boolean",n.is_online)&&(E.connectionStatus=n.is_online?Xe.ONLINE:Xe.OFFLINE),E.isActive=null===(p=n.is_active)||void 0===p||p,E.lastSeenAt=null!==(f=n.last_seen_at)&&void 0!==f?f:null,E.preferredLanguages=n.preferred_languages?o([],a(n.preferred_languages),!1):null,E.friendDiscoveryKey=null!==(_=n.friend_discovery_key)&&void 0!==_?_:null,E.friendName=null!==(g=n.friend_name)&&void 0!==g?g:null,E}return t(s,e),s.payloadify=function(t){return t?k(n(n({},e.payloadify.call(this,t)),{user_id:t.userId,nickname:t.nickname,profile_url:t.plainProfileUrl,require_auth_for_profile_image:t.requireAuth,metadata:t.metaData,is_online:t.connectionStatus,is_active:t.isActive,last_seen_at:t.lastSeenAt,preferred_languages:t.preferredLanguages,friend_discovery_key:t.friendDiscoveryKey,friend_name:t.friendName})):null},Object.defineProperty(s.prototype,"profileUrl",{get:function(){return this.requireAuth?"".concat(this.plainProfileUrl,"?auth=").concat(Ne(this._iid)):this.plainProfileUrl},enumerable:!1,configurable:!0}),s.prototype.serialize=function(){return Ye(this)},s.prototype._isValidMetaData=function(e){return!Array.isArray(e)&&Object.keys(e).length>0&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return y("string",e)}))},s.prototype._applyMetaData=function(e,t){var n=this;void 0===t&&(t=!1),Object.keys(e).forEach((function(r){t?delete n.metaData[r]:n.metaData[r]=e[r]}))},s.prototype.createMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,a,o;return i(this,(function(i){switch(i.label){case 0:return Ze(this._isValidMetaData(e)).throw(p.invalidParameters),t=ot.of(this._iid),n=t.sdkState,r=t.requestQueue,s=new Fe({userId:n.userId,metadata:e}),[4,r.send(s)];case 1:return a=i.sent(),o=a.as(Ke).metaData,this._applyMetaData(o),[2,this.metaData]}}))}))},s.prototype.updateMetaData=function(e,t){return void 0===t&&(t=!1),r(this,void 0,void 0,(function(){var n,r,s,a,o,u;return i(this,(function(i){switch(i.label){case 0:return Ze(this._isValidMetaData(e)).throw(p.invalidParameters),n=ot.of(this._iid),r=n.sdkState,s=n.requestQueue,a=new Be({userId:r.userId,metadata:e,upsert:t}),[4,s.send(a)];case 1:return o=i.sent(),u=o.as(Ve).metadata,this._applyMetaData(u),[2,this.metaData]}}))}))},s.prototype.deleteMetaData=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,a;return i(this,(function(i){switch(i.label){case 0:return Ze(y("string",e)).throw(p.invalidParameters),t=ot.of(this._iid),n=t.sdkState,r=t.requestQueue,s=new He({userId:n.userId,metadataKey:e}),[4,r.send(s)];case 1:return i.sent(),this._applyMetaData(((a={})[e]=!0,a),!0),[2,this.metaData]}}))}))},s.prototype.deleteAllMetaData=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return e=ot.of(this._iid),t=e.sdkState,n=e.requestQueue,r=new We({userId:t.userId}),[4,n.send(r)];case 1:return i.sent(),this.metaData={},[2]}}))}))},s}(Ae),tt=function(e){function r(t,n,r){var i,s,a,o,u,c,l,h,d,f,_,g=this;return(g=e.call(this,t,n,r)||this).pingInterval=15e3,g.pongTimeout=5e3,g.reconnectInterval=3e3,g.reconnectMaxInterval=6e4,g.reconnectRetryCount=5,g.reconnectIntervalMultiple=2,g.error=null,g.appInfo=new be(r),g.user=new et(t,r),g.key=r.key,g.ekey=null!==(i=r.ekey)&&void 0!==i?i:"",g.connectedAt=1e3*(null!==(s=r.login_ts)&&void 0!==s?s:0),g.pingInterval=null!==(a=r.ping_interval)&&void 0!==a?a:15e3,g.pongTimeout=null!==(o=r.pong_timeout)&&void 0!==o?o:5e3,r.reconnect&&(g.reconnectInterval=null!==(u=r.reconnect.interval)&&void 0!==u?u:3e3,g.reconnectMaxInterval=null!==(c=r.reconnect.max_interval)&&void 0!==c?c:6e4,g.reconnectRetryCount=null!==(l=r.reconnect.retry_cnt)&&void 0!==l?l:5,g.reconnectIntervalMultiple=null!==(h=r.reconnect.mul)&&void 0!==h?h:2),g.maxUnreadCountOnSuperGroup=null!==(d=r.max_unread_cnt_on_super_group)&&void 0!==d?d:100,g.profileImageEncryption=r.profile_image_encryption,g.concurrentCallLimit=null!==(f=r.concurrent_call_limit)&&void 0!==f?f:5,g.backOffDelay=null!==(_=r.back_off_delay)&&void 0!==_?_:100,g.error=r.error?new p(r):null,g}return t(r,e),r.asError=function(e){return new r(null,"LOGI",n({user_id:null,error:!0},e))},r.prototype.applyTo=function(e){if(this.error)throw this.error;var t=ot.of(e);if(!t)throw p.lostInstance;t.sessionManager.auth.sessionKey=this.key,Ne(e,this.ekey),t.sdkState.websocket.pingInterval=1e3*this.pingInterval,t.sdkState.websocket.pongTimeout=1e3*this.pongTimeout,t.sdkState.websocket.reconnectMaxRetry=this.reconnectRetryCount,t.sdkState.websocket.reconnectRetryStrategy={calcTimeout:function(e){return e>0?Math.min(n*Math.pow(i,e-1),r):10}},t.appInfo=this.appInfo,t.sessionManager.currentUser=this.user;var n=this.reconnectInterval,r=this.reconnectMaxInterval,i=this.reconnectIntervalMultiple;t.connectedAt=this.connectedAt,t.maxSuperGroupChannelUnreadCount=this.maxUnreadCountOnSuperGroup,t.concurrentCallLimit=this.concurrentCallLimit,t.backOffDelay=this.backOffDelay},r}(G),nt=function(e){function n(t,n){var r=n.sdkState,i=n.connectionHandlers,s=n.sessionManager,a=n.websocketClient,o=n.dispatcher,u=n.logger,c=n.entryState,l=void 0===c?new Ie:c,h=e.call(this)||this;return h._currentState=null,h._loginTimer=null,h._connectionRequestQueue=[],h._iid=t,h.sdkState=r,h.connectionHandlers=i,h._sessionManager=s,h._websocketClient=a,h._dispatcher=o,h._logger=u,h._currentState=l,h._websocketClient.on("message",(function(e){if("LOGI"===e.code){h._loginTimer&&(clearTimeout(h._loginTimer),h._loginTimer=null);var t=e.as(tt);t.error?(t.error.isSessionKeyExpiredError&&h._dispatcher.dispatch(new q),h._connectionRequestQueue.forEach((function(e){return e.reject(t.error)}))):(t.applyTo(h._iid),h._connectionRequestQueue.forEach((function(e){return e.resolve()}))),h._connectionRequestQueue=[]}})).on("close",(function(){h._connectionRequestQueue.forEach((function(e){return e.reject(p.networkError)})),h._connectionRequestQueue=[]})),h}return t(n,e),Object.defineProperty(n.prototype,"currentState",{get:function(){return this._currentState},enumerable:!1,configurable:!0}),n.prototype.changeState=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this._currentState=e,this._dispatcher.dispatch(new ie({stateType:e.type})),this._logger.debug("connection state changes to ".concat(e.name)),[4,this._currentState.run(this)];case 1:return t.sent(),[2]}}))}))},n.prototype._url=function(e){void 0===e&&(e="");var t=this.sdkState,n=t.appId,r=t.appVersion,i=t.userId,s=this._sessionManager.auth;return"".concat(this.sdkState.websocket.host,"/?p=JS&pv=").concat(encodeURIComponent(l.OS_VERSION),"&sv=").concat(encodeURIComponent(l.SDK_VERSION),"&ai=").concat(n).concat(r?"&av=".concat(r):"").concat(s.hasSession?"&key=".concat(encodeURIComponent(s.sessionKey)):"&user_id=".concat(encodeURIComponent(i),"&access_token=").concat(encodeURIComponent(e)),"&active=1&SB-User-Agent=").concat("FIXME","&Request-Sent-Timestamp=").concat(Date.now().toString(),"&include_extra_data=").concat(encodeURIComponent(String(["premium_feature_list","file_upload_size_limit","application_attributes","emoji_hash"]))).concat(this._sessionManager.handler?"&expiring_session=1":"","&use_local_cache=1")},n.prototype.connect=function(e){return void 0===e&&(e=""),r(this,void 0,void 0,(function(){var t,n,r=this;return i(this,(function(i){return t=this._url(e),n=new W,this._connectionRequestQueue.push(n),1===this._connectionRequestQueue.length&&(this._loginTimer=setTimeout((function(){r._loginTimer=null,r._dispatcher.dispatch(tt.asError(p.loginTimeout))}),this.sdkState.websocket.responseTimeout),this._websocketClient.connect(t)),[2,n.promise]}))}))},n.prototype.disconnect=function(){this._websocketClient.disconnect()},n.prototype.logout=function(){this.sdkState.userId=null,this._sessionManager.currentUser=null,this._sessionManager.auth.clear(),this.disconnect()},n}(R),rt=function(){function e(e,t){var n=t.sdkState,r=t.connectionHandlers,i=t.sessionManager,s=t.websocketClient,a=t.dispatcher,o=t.logger,u=t.disableAutoReconnect,c=void 0!==u&&u,l=this;this._context=null,this._context=new nt(e,{sdkState:n,connectionHandlers:r,sessionManager:i,websocketClient:s,dispatcher:a,logger:o}),this._logger=o,c||s.on("close",(function(){"foreground"===n.appState&&(l._logger.debug("try reconnect by websocket connection closed"),l.reconnect())}))}return Object.defineProperty(e.prototype,"isConnected",{get:function(){return this._context.currentState.type===B.CONNECTED},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnecting",{get:function(){var e=this._context.currentState;return e.type===B.CONNECTING||e.type===B.RECONNECTING},enumerable:!1,configurable:!0}),e.prototype.connect=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._context.currentState.onConnect(this._context,e)];case 1:return t.sent(),[2]}}))}))},e.prototype.reconnect=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onReconnect(this._context)];case 1:return e.sent(),[2]}}))}))},e.prototype.background=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{autoReconnect:!1})];case 1:return e.sent(),[2]}}))}))},e.prototype.disconnect=function(e){return void 0===e&&(e=null),r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this._context.currentState.onDisconnect(this._context,{error:e,autoReconnect:!0})];case 1:return t.sent(),[2]}}))}))},e.prototype.logout=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this._context.currentState.onLogout(this._context)];case 1:return e.sent(),[2]}}))}))},e}();!function(e){e[e.NONE=0]="NONE",e[e.VERBOSE=1]="VERBOSE",e[e.DEBUG=2]="DEBUG",e[e.INFO=3]="INFO",e[e.WARN=4]="WARN",e[e.ERROR=5]="ERROR"}($e||($e={}));var it,st=function(){function e(){this.level=$e.WARN}return e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=$e.VERBOSE&&console.log.apply(console,o(["[verbose]"],a(e),!1))},e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=$e.DEBUG&&console.log.apply(console,o(["[debug]"],a(e),!1))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=$e.INFO&&console.log.apply(console,o(["[info]"],a(e),!1))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=$e.WARN&&console.warn.apply(console,o(["[warn]"],a(e),!1))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.level<=$e.ERROR&&console.error.apply(console,o(["[error]"],a(e),!1))},e}(),at={},ot=function(){function e(e,t){var n,r,i,s,a,o;if(this.connectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,!at[e]){at[e]=this;var u=null!==(n=t.options)&&void 0!==n?n:new I,c=this.sdkState={appId:t.appId,appVersion:null!==(r=t.appVersion)&&void 0!==r?r:"",appState:"foreground",userId:null,extensions:{},api:{host:null!==(i=t.apiHost)&&void 0!==i?i:"https://api-".concat(t.appId,".sendbird.com")},websocket:{host:null!==(s=t.websocketHost)&&void 0!==s?s:"wss://ws-".concat(t.appId,".sendbird.com"),pingerDisabled:!!t.noPingpong,pingInterval:null,pongTimeout:null,connectMaxRetry:2,reconnectMaxRetry:-1,reconnectRetryStrategy:new de,responseTimeout:u.websocketResponseTimeout}};this.appInfo=null,this.subscribedUnreadMessageCount={all:0,customTypes:{},ts:0};var h=this.logger=new st;this.logger.level=null!==(a=t.logLevel)&&void 0!==a?a:$e.WARN,this.connectedAt=0,this.connectionHandlers=new Map,this.userEventHandlers=new Map,this.cacheContext=new N({encryption:t.encryption,store:t.store,localCacheEnabled:t.localCacheEnabled}),this.debugMode=null!==(o=t.debugMode)&&void 0!==o&&o,this.maxSuperGroupChannelUnreadCount=l.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,this.useMemberAsMessageSender=u.useMemberAsMessageSender,this.typingIndicatorInvalidateTime=u.typingIndicatorInvalidateTime,this.typingIndicatorThrottle=u.typingIndicatorThrottle,this.concurrentCallLimit=null,this.backOffDelay=null;var d=this.dispatcher=new D,p=new A;this.requestQueue=new se(e,{auth:p,sdkState:c,dispatcher:d,logger:h}),this.sessionManager=new ge({auth:p,sdkState:c,dispatcher:d,requestQueue:this.requestQueue,logger:h}),this.connectionManager=new rt(e,{sdkState:c,connectionHandlers:this.connectionHandlers,dispatcher:d,sessionManager:this.sessionManager,websocketClient:this.requestQueue.commandRouter.websocketClient,logger:h})}return at[e]}return e.of=function(e){if(at[e])return at[e];throw p.lostInstance},e}(),ut=function(){function e(){}return e.prototype.init=function(e,t){var n=t.sdkState,r=t.dispatcher,i=t.sessionManager,s=t.requestQueue,a=t.logger,o=t.cacheContext,u=void 0===o?null:o;this._iid=e,this._cacheContext=u,this._sdkState=n,this._dispatcher=r,this._sessionManager=i,this._requestQueue=s,this._logger=a},e}(),ct=function(e){function n(t){var n=e.call(this)||this;if(n.method=h.POST,n.path="".concat(Ce),n.params=k({file:t.file,channel_url:t.channelUrl}),t.thumbnailSizes)for(var r=0;r<t.thumbnailSizes.length;r++){var i=t.thumbnailSizes[r],s=i.maxWidth,a=i.maxHeight;n.params["thumbnail".concat(r+1)]="".concat(s,",").concat(a)}return n.requestId=t.requestId,n}return t(n,e),n}(U),lt=function(e){function n(t,n){var r,i,s,a=this;return(a=e.call(this,t,n)||this).url=n.url,a.fileSize=null!==(r=n.file_size)&&void 0!==r?r:0,a.thumbnailSizes=null!==(i=n.thumbnails)&&void 0!==i?i:[],a.requireAuth=null!==(s=n.require_auth)&&void 0!==s&&s,a}return t(n,e),n}(P),ht=function(e){function r(t,n){var r,i,s,a=this;return(a=e.call(this,t)||this).replyCount=0,a.mostRepliedUsers=null,a.lastRepliedAt=0,a.updatedAt=0,a.replyCount=null!==(r=n.reply_count)&&void 0!==r?r:0,a.mostRepliedUsers=n.hasOwnProperty("most_replies")&&E("object",n.most_replies)?n.most_replies.map((function(e){return new et(a._iid,e)})):[],a.lastRepliedAt=null!==(i=n.last_replied_at)&&void 0!==i?i:0,a.updatedAt=null!==(s=n.updated_at)&&void 0!==s?s:0,a}return t(r,e),r.payloadify=function(t){return t?k(n(n({},e.payloadify.call(this,t)),{reply_count:t.replyCount,most_replies:Array.isArray(t.mostRepliedUsers)?t.mostRepliedUsers.map((function(e){return et.payloadify(e)})):[],last_replied_at:t.lastRepliedAt,updated_at:t.updatedAt})):null},r}(Ae);!function(e){e.ADD="add",e.DELETE="delete"}(it||(it={}));var dt,pt=function(e){this.messageId=0,this.userId=null,this.key=null,this.operation=null,this.updatedAt=0;var t=y("string",e.msg_id)?parseInt(e.msg_id):e.msg_id,n=e.user_id,r=e.operation?e.operation.toLowerCase():null,i=e.reaction,s=e.updated_at;t&&y("string",n)&&y("string",r)&&m(it,r)&&y("string",i)&&i&&y("number",s)&&(this.messageId=t,this.userId=n,this.key=i,this.operation=r,this.updatedAt=s)},ft=function(){function e(e){var t,n,r,i=e.key,u=null!==(r=o([],a(e.user_ids),!1))&&void 0!==r?r:[],c=e.updated_at;y("string",i)&&i&&E("string",u)&&u.length>0&&y("number",c)&&(this.key=i,this.userIds=u,this.updatedAt=c);var l={};try{for(var h=s(this.userIds),d=h.next();!d.done;d=h.next()){l[d.value]=this.updatedAt}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=h.return)&&n.call(h)}finally{if(t)throw t.error}}this._version=l}return Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.userIds.length},enumerable:!1,configurable:!0}),e.payloadify=function(e){return e?k({key:e.key,user_ids:e.userIds,updated_at:e.updatedAt}):null},e.prototype.applyEvent=function(e){if(e.key===this.key&&this.updatedAt<=e.updatedAt){if(!this._version[e.userId]||this._version[e.userId]<=e.updatedAt){var t=this.userIds.indexOf(e.userId);switch(e.operation){case it.ADD:t<0&&this.userIds.push(e.userId);break;case it.DELETE:t>=0&&this.userIds.splice(t,1)}this._version[e.userId]=e.updatedAt}this.updatedAt=Math.max(this.updatedAt,e.updatedAt)}},e}(),_t=function(){function e(e){this.key=e.key,this.value=E("string",e.value)?o([],a(e.value),!1):[]}return e.payloadify=function(e){var t;return e?k({key:e.key,value:null!==(t=e.value)&&void 0!==t?t:[]}):null},e}(),gt=function(){function e(e){this.url=null,this.secureUrl=null,this.type=null,this.width=0,this.height=0,this.alt=null,this.url=e.url,e.hasOwnProperty("secure_url")&&(this.secureUrl=e.secure_url),e.hasOwnProperty("type")&&(this.type=e.type),e.hasOwnProperty("width")&&(this.width=e.width),e.hasOwnProperty("height")&&(this.height=e.height),e.hasOwnProperty("alt")&&(this.alt=e.alt)}return e.payloadify=function(e){var t,n;return e?k({url:e.url,secure_url:e.secureUrl,type:e.type,width:null!==(t=e.width)&&void 0!==t?t:0,height:null!==(n=e.height)&&void 0!==n?n:0,alt:e.alt}):null},e}(),yt=function(){function e(e){this.title=null,this.url=null,this.description=null,this.defaultImage=null,e.hasOwnProperty("og:title")&&(this.title=e["og:title"]),e.hasOwnProperty("og:url")&&(this.url=e["og:url"]),e.hasOwnProperty("og:description")&&(this.description=e["og:description"]),e.hasOwnProperty("og:image")&&(this.defaultImage=new gt(e["og:image"]))}return e.payloadify=function(e){return e?k({"og:title":e.title,"og:url":e.url,"og:description":e.description,"og:image":e.defaultImage?gt.payloadify(e.defaultImage):null}):null},e}(),mt=function(){function e(e){var t,n;this.name=null,this.volume=0,this.name=null!==(t=e.name)&&void 0!==t?t:"default",this.volume=null!==(n=e.volume)&&void 0!==n?n:1}return e.payloadify=function(e){return e?k({name:e.name,volume:e.volume}):null},e}(),Et=function(e){switch(e){case Z.BASE:return"";case Z.USER:return"MESG";case Z.FILE:return"FILE";case Z.ADMIN:return"ADMM"}},vt=function(e){function r(t,n){var r,i,s,a,o,u,c,l,h,d,p,f,_,g=this;(g=e.call(this,t)||this).channelUrl=null,g.channelType=Y.BASE,g.messageId=0,g.parentMessageId=null,g.silent=!1,g.isOperatorMessage=!1,g.messageType=Z.BASE,g.data=null,g.customType=null,g.mentionType=null,g.mentionedUsers=[],g.mentionedMessageTemplate=null,g.threadInfo=null,g.reactions=[],g.metaArrays=[],g.ogMetaData=null,g.appleCriticalAlertOptions=null,g.createdAt=0,g.updatedAt=0,g.messageId=null!==(i=null!==(r=n.msg_id)&&void 0!==r?r:n.message_id)&&void 0!==i?i:0,g.channelUrl=n.channel_url,g.channelType=m(Y,n.channel_type)?n.channel_type:Y.GROUP,n.channel&&(n.channel.channel_url&&(g.channelUrl=n.channel.channel_url),n.channel.channel_type&&(g.channelType=n.channel.channel_type)),g.parentMessageId=null!==(s=n.parent_message_id)&&void 0!==s?s:0,g.data=null!==(a=n.data)&&void 0!==a?a:"",g.customType=null!==(o=n.custom_type)&&void 0!==o?o:"",g.mentionType=m(ee,n.mention_type)?n.mention_type:null,g.mentionedUsers=n.mentioned_users?n.mentioned_users.map((function(e){return new et(g._iid,e)})):[],g.mentionedMessageTemplate=null!==(u=n.mentioned_message_template)&&void 0!==u?u:"",g.threadInfo=n.thread_info?new ht(g._iid,n.thread_info):null,g.reactions=n.reactions?n.reactions.map((function(e){return new ft(e)})):[];for(var y=null!==(c=n.metaarray)&&void 0!==c?c:{},E=null!==(l=n.metaarray_key_order)&&void 0!==l?l:Object.keys(y).sort((function(e,t){return e.localeCompare(t)})),v=0;v<E.length;v++){var T=E[v];g.metaArrays.push(new _t({key:T,value:y[T]||[]}))}return n.sorted_metaarray&&(g.metaArrays=n.sorted_metaarray.map((function(e){return new _t(e)}))),g.ogMetaData=n.og_tag?new yt(n.og_tag):null,g.silent=null!==(h=n.silent)&&void 0!==h&&h,g.isOperatorMessage=null!==(d=n.is_op_msg)&&void 0!==d&&d,g.appleCriticalAlertOptions=n.apple_critical_alert_options?new mt(n.apple_critical_alert_options):null,g.createdAt=null!==(f=null!==(p=n.created_at)&&void 0!==p?p:n.ts)&&void 0!==f?f:0,g.updatedAt=null!==(_=n.updated_at)&&void 0!==_?_:0,g}return t(r,e),r.payloadify=function(t){return t?k(n(n({},e.payloadify.call(this,t)),{channel_url:t.channelUrl,channel_type:t.channelType,message_id:t.messageId,type:Et(t.messageType),parent_message_id:t.parentMessageId,data:t.data,custom_type:t.customType,mention_type:t.mentionType,mentioned_users:t.mentionedUsers.map((function(e){return et.payloadify(e)})),mentioned_message_template:t.mentionedMessageTemplate,thread_info:t.threadInfo?ht.payloadify(t.threadInfo):null,reactions:t.reactions.map((function(e){return ft.payloadify(e)})),sorted_metaarray:t.metaArrays.map((function(e){return _t.payloadify(e)})),og_tag:yt.payloadify(t.ogMetaData),silent:t.silent,is_op_msg:t.isOperatorMessage,apple_critical_alert_options:mt.payloadify(t.appleCriticalAlertOptions),created_at:t.createdAt,updated_at:t.updatedAt})):null},r.prototype.isIdentical=function(e){return this.messageId===e.messageId},r.prototype.isEqual=function(e){return g(this,e)},Object.defineProperty(r.prototype,"isUserMessage",{get:function(){return this.messageType===Z.USER},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isFileMessage",{get:function(){return this.messageType===Z.FILE},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isAdminMessage",{get:function(){return this.messageType===Z.ADMIN},enumerable:!1,configurable:!0}),r.prototype.serialize=function(){return Ye(this)},r.prototype.getMetaArraysByKeys=function(e){return this.metaArrays.filter((function(t){return e.includes(t.key)}))},r.prototype.applyThreadInfoUpdateEvent=function(e){return this.parentMessageId===e.targetMessageId&&(this.threadInfo=e.threadInfo),!1},r.prototype.applyReactionEvent=function(e){if(this.messageId===e.messageId){for(var t=!1,n=0;n<this.reactions.length;n++)if(this.reactions[n].key===e.key){this.reactions[n].applyEvent(e),this.reactions[n].isEmpty&&this.reactions.splice(n,1),t=!0;break}t||"add"!==e.operation||this.reactions.push(new ft(ft.payloadify({key:e.key,userIds:[e.userId],updatedAt:e.updatedAt})))}},r}(Ae),Tt=function(e){function r(t,n){var r=e.call(this,t,n)||this;return r.role=null,r.isBlockedByMe=!1,r.role=m(J,n.role)?n.role:J.NONE,n.hasOwnProperty("is_blocked_by_me")&&(r.isBlockedByMe=n.is_blocked_by_me),r}return t(r,e),r.payloadify=function(t){return t?k(n(n({},e.payloadify.call(this,t)),{role:t.role,is_blocked_by_me:t.isBlockedByMe})):null},r}(et),St=function(e){function r(t,n){var r,i,s,a,o=this;return(o=e.call(this,t,n)||this).sender=null,o.reqId="",o.replyToChannel=!1,o.requestState=re.PENDING,o.requestedMentionUserIds=[],o.errorCode=0,o.sender=new Tt(o._iid,n.user),o.reqId=null!==(r=n.req_id)&&void 0!==r?r:"",o.replyToChannel=null!==(i=n.is_reply_to_channel)&&void 0!==i&&i,o.requestState=o.messageId>0?re.SUCCEEDED:re.FAILED,n.request_state&&m(re,n.request_state)&&(o.requestState=n.request_state),o.requestedMentionUserIds=null!==(s=n.requested_mention_user_ids)&&void 0!==s?s:[],o.errorCode=null!==(a=n.error_code)&&void 0!==a?a:0,o}return t(r,e),r.payloadify=function(t){return t?k(n(n({},e.payloadify.call(this,t)),{user:Tt.payloadify(t.sender),req_id:t.reqId,is_reply_to_channel:t.replyToChannel,request_state:t.requestState,requested_mention_user_ids:t.requestedMentionUserIds,error_code:t.errorCode})):null},Object.defineProperty(r.prototype,"isResendable",{get:function(){return this.requestState===re.FAILED&&((e=this.errorCode)>0&&f.indexOf(e)>=0);var e},enumerable:!1,configurable:!0}),r.prototype.isIdentical=function(e){return this.messageId>0&&e.messageId>0?this.messageId===e.messageId:this.reqId===e.reqId},r}(vt),It=function(){function e(e){var t,n;this.url=null,this.width=0,this.height=0,this.realWidth=0,this.realHeight=0,this.url=e.url,this.width=e.width,this.height=e.height,this.realWidth=null!==(t=e.real_width)&&void 0!==t?t:e.width,this.realHeight=null!==(n=e.real_height)&&void 0!==n?n:e.height}return e.payloadify=function(e){return e?k({url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}):null},Object.defineProperty(e.prototype,"plainUrl",{get:function(){return this.url.split("?auth=")[0]},enumerable:!1,configurable:!0}),e}(),bt=function(){this.prevResultSize=0,this.nextResultSize=0,this.isInclusive=!1,this.reverse=!1,this.messageTypeFilter=$.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.includeReactions=!1,this.includeMetaArray=!1,this.includeParentMessageInfo=!1},Ot=function(e){function n(t){var n=e.call(this)||this;if(t)for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);return n}return t(n,e),n.prototype.validate=function(){return y("number",this.prevResultSize)&&y("number",this.nextResultSize)&&y("boolean",this.isInclusive)&&y("boolean",this.reverse)&&y("string",this.messageTypeFilter)&&m($,this.messageTypeFilter)&&E("string",this.customTypesFilter,!0)&&E("string",this.senderUserIdsFilter,!0)&&y("boolean",this.includeMetaArray)&&y("boolean",this.includeReactions)&&y("boolean",this.includeParentMessageInfo)},n}(bt),Nt=function(e){function s(t,r){var i,s,a,o,u,c,l,h,d,p,f,_,g,y=this;(y=e.call(this,t,r)||this).messageParams=null,y.plainUrl="",y.requireAuth=!1,y.name=null,y.size=0,y.type=null,y.thumbnails=[],y.messageSurvivalSeconds=-1,y.messageType=Z.FILE;var m=null!==(i=r.file)&&void 0!==i?i:{};return y.plainUrl=(null!==(a=null!==(s=m.url)&&void 0!==s?s:r.url)&&void 0!==a?a:"").split("?auth=")[0],y.name=null!==(u=null!==(o=m.name)&&void 0!==o?o:r.name)&&void 0!==u?u:"File",y.size=null!==(l=null!==(c=m.size)&&void 0!==c?c:r.size)&&void 0!==l?l:0,y.data=null!==(d=null!==(h=m.data)&&void 0!==h?h:r.custom)&&void 0!==d?d:"",y.type=m?null!==(p=m.type)&&void 0!==p?p:"":null!==(f=r.type)&&void 0!==f?f:"",y.requireAuth=null!==(_=r.require_auth)&&void 0!==_&&_,y.thumbnails=r.thumbnails?r.thumbnails.map((function(e){return new It(n(n({},e),{url:"".concat(e.url.split("?auth=")[0]).concat(y.requireAuth?"?auth=".concat(Ne(y._iid)):"")}))})):[],y.messageSurvivalSeconds=null!==(g=r.message_survival_seconds)&&void 0!==g?g:-1,y}return t(s,e),s.payloadify=function(t){return t?k(n(n({},e.payloadify.call(this,t)),{url:t.plainUrl,require_auth:t.requireAuth,file:{name:t.name,size:t.size,type:t.type,data:t.data},thumbnails:t.thumbnails.map((function(e){return{url:e.url,width:e.width,height:e.height,real_width:e.realWidth,real_height:e.realHeight}})),message_survival_seconds:t.messageSurvivalSeconds})):null},Object.defineProperty(s.prototype,"url",{get:function(){return this.requireAuth?"".concat(this.plainUrl,"?auth=").concat(Ne(this._iid)):this.plainUrl},enumerable:!1,configurable:!0}),s.prototype.getThreadedMessagesByTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return Ze(this.messageId>0&&y("number",e)&&t instanceof Ot&&t.validate()).throw(p.invalidParameters),[4,Yt.of(this._iid).getThreadedMessagesByTimestamp(this,e,t)];case 1:return[2,n.sent()]}}))}))},s}(St),At=function(e){function n(t){var n,r,i;return e.call(this,{code:"FILE",ackRequired:!0,payload:k({channel_url:t.channelUrl,url:t.url,name:null!==(n=t.fileName)&&void 0!==n?n:"",type:null!==(r=t.mimeType)&&void 0!==r?r:"",size:null!==(i=t.fileSize)&&void 0!==i?i:0,custom:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes,require_auth:t.requireAuth,metaarray:t.metaArrays,mention_type:t.mentionType,mentioned_user_ids:t.mentionType===ee.USERS?t.mentionedUserIds:[],push_option:t.pushNotificationDeliveryOption&&t.pushNotificationDeliveryOption!==ne.DEFAULT?t.pushNotificationDeliveryOption:void 0,apple_critical_alert_options:t.appleCriticalAlertOptions,silent:t.silent,is_reply_to_channel:t.isReplyToChannel,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,req_id:t.reqId})})||this}return t(n,e),n}(Q),wt=function(e){function n(t){var n=e.call(this)||this;return n.method=h.POST,n.path="".concat(xe(t.channelType),"/").concat(encodeURIComponent(t.channelUrl),"/messages"),n.params=k({message_type:Z.FILE,user_id:t.userId,url:t.file,mention_type:t.mentionType,mentioned_user_ids:t.mentionedUserIds,file_name:t.fileName,file_size:t.fileSize,file_type:t.mimeType,data:t.data,custom_type:t.customType,thumbnails:t.thumbnailSizes.map((function(e){return It.payloadify(e)})),require_auth:t.requireAuth,sorted_metaarray:t.metaArrays.map((function(e){return _t.payloadify(e)})),push_option:t.pushNotificationDeliveryOption,parent_message_id:t.parentMessageId>0?t.parentMessageId:null,apple_critical_alert_options:mt.payloadify(t.appleCriticalAlertOptions),reply_to_channel:t.isReplyToChannel,req_id:t.reqId}),n}return t(n,e),n}(U),Ct=function(e){function n(t,n,r){var i,s=this;(s=e.call(this,t,"FILE",r)||this).message=new Nt(t,r);var a=ot.of(t).sdkState;return s.isMentioned=Qe(s.message.mentionType,s.message.mentionedUsers.map((function(e){return e.userId})),a.userId),s.forceUpdateLastMessage=null!==(i=r.force_update_last_message)&&void 0!==i&&i,s}return t(n,e),n}(G),Rt=function(e){function n(t,n){var r,i=this;(i=e.call(this,t,n)||this).message=new Nt(t,n);var s=ot.of(t).sdkState;return i.isMentioned=Qe(i.message.mentionType,i.message.mentionedUsers.map((function(e){return e.userId})),s.userId),i.forceUpdateLastMessage=null!==(r=n.force_update_last_message)&&void 0!==r&&r,i}return t(n,e),n}(P);!function(e){e[e.PENDING=0]="PENDING",e[e.UPLOADING=1]="UPLOADING",e[e.UPLOADED=2]="UPLOADED",e[e.SENDING=3]="SENDING",e[e.FAILED=4]="FAILED"}(dt||(dt={}));var Dt,Mt=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.cacheContext,a=this;this._queueMap=new Map,this._isConnected=!1,this._iid=e,this._sdkState=n,this._requestQueue=i,this._cacheContext=s,this._dispatcher=r,this._dispatcher.on((function(e){if(e instanceof ie)if(e.stateType===B.CONNECTED)a._isConnected=!0;else a._isConnected=!1}))}return e.prototype._sendFileMessage=function(e,t){return r(this,void 0,void 0,(function(){var r,s;return i(this,(function(i){switch(i.label){case 0:return this._isConnected?(r=new At(n(n({channelUrl:e.url,channelType:e.channelType,url:t.params.file,requireAuth:t.requireAuth},t.params),{reqId:t.requestId})),[4,this._requestQueue.send(r)]):[3,2];case 1:return s=i.sent(),[2,s.as(Ct).message];case 2:if(!this._cacheContext.localCacheEnabled)return[3,3];throw new p({code:u.WEBSOCKET_CONNECTION_CLOSED});case 3:return r=new wt(n(n({channelUrl:e.url,channelType:e.channelType,url:t.params.file,userId:this._sdkState.userId,requireAuth:t.requireAuth},t.params),{reqId:t.requestId})),[4,this._requestQueue.send(r)];case 4:return s=i.sent(),[2,s.as(Rt).message]}}))}))},e.prototype._resolveMessageQueue=function(e){return r(this,void 0,void 0,(function(){var t,n,r,a,o,c,l,h,d,f,_,g;return i(this,(function(i){switch(i.label){case 0:if(!(t=this._queueMap.get(e.url)))return[3,21];if(t.isResolving)return[3,20];t.isResolving=!0,n=[],r=!0,i.label=1;case 1:i.trys.push([1,15,16,17]),a=s(t.messageQueue),o=a.next(),i.label=2;case 2:if(o.done)return[3,14];switch(c=o.value,c.state){case dt.PENDING:case dt.UPLOADING:return[3,3];case dt.UPLOADED:return[3,4];case dt.FAILED:return[3,12]}return[3,13];case 3:return r=!1,n.push(c),[3,13];case 4:if(!r)return[3,10];i.label=5;case 5:return i.trys.push([5,8,,9]),c.state=dt.SENDING,[4,this._sendFileMessage(e,c)];case 6:return l=i.sent(),c.deferred.resolve(l),[4,he(100)];case 7:return i.sent(),[3,9];case 8:return h=i.sent(),c.deferred.reject(h),[3,9];case 9:return[3,11];case 10:n.push(c),i.label=11;case 11:return[3,13];case 12:return c.deferred.reject(c.error.code===u.REQUEST_CANCELED?p.fileUploadCanceled:c.error),[3,13];case 13:return o=a.next(),[3,2];case 14:return[3,17];case 15:return d=i.sent(),_={error:d},[3,17];case 16:try{o&&!o.done&&(g=a.return)&&g.call(a)}finally{if(_)throw _.error}return[7];case 17:return f=t.isResolveRequestPending,t.messageQueue=n,t.isResolving=!1,t.isResolveRequestPending=!1,f?[4,this._resolveMessageQueue(e)]:[3,19];case 18:i.sent(),i.label=19;case 19:return[3,21];case 20:t.isResolveRequestPending=!0,i.label=21;case 21:return[2]}}))}))},e.prototype._uploadNextPendingItem=function(e){return r(this,void 0,void 0,(function(){var t,n,r,s,a,o,u,c,l,h,d,p,f,_;return i(this,(function(i){switch(i.label){case 0:if(t=this._queueMap.get(e.url),!(n=t.messageQueue.find((function(e){return e.state===dt.PENDING}))))return[3,9];if(!T(n.params.file))return[3,7];if(!(t.uploadQueue.length<6))return[3,6];n.state=dt.UPLOADING,t.uploadQueue.push(n),i.label=1;case 1:return i.trys.push([1,3,4,6]),r=new ct({file:n.params.file,channelUrl:e.url,thumbnailSizes:n.params.thumbnailSizes,requestId:n.requestId}),[4,this._requestQueue.send(r)];case 2:return s=i.sent(),a=s.as(lt),o=a.url,u=a.fileSize,c=void 0===u?n.params.fileSize:u,l=a.thumbnailSizes,h=void 0===l?n.params.thumbnailSizes:l,d=a.requireAuth,p=void 0!==d&&d,n.params.fileUrl=o,n.params.fileSize=c,n.params.thumbnailSizes=h,n.params._requireAuth=p,n.requireAuth=p,n.state=dt.UPLOADED,[3,6];case 3:return f=i.sent(),n.state=dt.FAILED,n.error=f,[3,6];case 4:return(_=t.uploadQueue.findIndex((function(e){return e.requestId===n.requestId})))>=0&&(t.uploadQueue.splice(_,1),this._uploadNextPendingItem(e)),[4,this._resolveMessageQueue(e)];case 5:return i.sent(),[7];case 6:return[3,9];case 7:return n.params.thumbnailSizes=[],n.state=dt.UPLOADED,[4,this._resolveMessageQueue(e)];case 8:i.sent(),i.label=9;case 9:return[2]}}))}))},e.prototype.request=function(e,t,n){var s,a,o;return r(this,void 0,void 0,(function(){var r;return i(this,(function(i){return r=new W,T(n.file)&&(n.fileName=null!==(s=n.fileName)&&void 0!==s?s:n.file.name,n.mimeType=null!==(a=n.mimeType)&&void 0!==a?a:n.file.type,n.fileSize=null!==(o=n.fileSize)&&void 0!==o?o:n.file.size),this._queueMap.has(e.url)||this._queueMap.set(e.url,{messageQueue:[],uploadQueue:[],isResolving:!1,isResolveRequestPending:!1}),this._queueMap.get(e.url).messageQueue.push({requestId:t,params:n,state:dt.PENDING,deferred:r,requireAuth:n._requireAuth}),this._uploadNextPendingItem(e),[2,r.promise]}))}))},e.prototype.cancel=function(e,t){var n,r;void 0===t&&(t=null);var i=this._queueMap.get(e.url);if(i){var u=t?[i.messageQueue.find((function(e){return e.requestId===t}))]:o([],a(i.messageQueue),!1);try{for(var c=s(u),l=c.next();!l.done;l=c.next()){var h=l.value;if(h)switch(h.state){case dt.PENDING:h.state=dt.FAILED,h.error=p.requestCanceled,this._resolveMessageQueue(e);break;case dt.UPLOADING:this._requestQueue.cancel(h.requestId)}}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}},e}(),kt=function(){function e(e){var t,n;this.type=null,this.vendor=null,this.detail={},this.type=null!==(t=e.type)&&void 0!==t?t:"",this.vendor=null!==(n=e.vendor)&&void 0!==n?n:"",e.hasOwnProperty("detail")&&y("object",e.detail)&&!Array.isArray(e.detail)&&(this.detail=e.detail)}return e.payloadify=function(e){return e?k({type:e.type,vendor:e.vendor,detail:e.detail}):null},e}(),Lt=function(e){function s(t,n){var r,i,s=this;return(s=e.call(this,t,n)||this).message="",s.messageParams=null,s.translations={},s.messageSurvivalSeconds=-1,s.plugins=[],s.message=n.message,s.messageType=Z.USER,s.translations=null!==(r=n.translations)&&void 0!==r?r:{},s.messageSurvivalSeconds=null!==(i=n.message_survival_seconds)&&void 0!==i?i:-1,s.plugins=n.plugins?n.plugins.map((function(e){return new kt(e)})):[],s}return t(s,e),s.payloadify=function(t){return t?k(n(n({},e.payloadify.call(this,t)),{message:t.message,translations:t.translations,message_survival_seconds:t.messageSurvivalSeconds,plugins:t.plugins.map((function(e){return kt.payloadify(e)}))})):null},s.prototype.getThreadedMessagesByTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return Ze(this.messageId>0&&y("number",e)&&t instanceof Ot&&t.validate()).throw(p.invalidParameters),[4,Yt.of(this._iid).getThreadedMessagesByTimestamp(this,e,t)];case 1:return[2,n.sent()]}}))}))},s}(St),Ut=function(e){function s(t,n){var r,i,s=this;return(s=e.call(this,t,n)||this).message=null,s.translations={},s.message=null!==(r=n.message)&&void 0!==r?r:"",s.messageType=Z.ADMIN,s.translations=null!==(i=n.translations)&&void 0!==i?i:{},s}return t(s,e),s.payloadify=function(t){return t?k(n(n({},e.payloadify.call(this,t)),{message:t.message,translations:t.translations})):null},s.prototype.getThreadedMessagesByTimestamp=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return Ze(this.messageId>0&&y("number",e)&&t instanceof Ot&&t.validate()).throw(p.invalidParameters),[4,Yt.of(this._iid).getThreadedMessagesByTimestamp(this,e,t)];case 1:return[2,n.sent()]}}))}))},s}(vt);!function(e){e.UNKNOWN="UNKNOWN",e.EVENT_MESSAGE_SENT_SUCCESS="EVENT_MESSAGE_SENT_SUCCESS",e.EVENT_MESSAGE_SENT_FAILED="EVENT_MESSAGE_SENT_FAILED",e.EVENT_MESSAGE_SENT_PENDING="EVENT_MESSAGE_SENT_PENDING",e.EVENT_MESSAGE_RECEIVED="EVENT_MESSAGE_RECEIVED",e.EVENT_MESSAGE_UPDATED="EVENT_MESSAGE_UPDATED",e.EVENT_MESSAGE_DELETED="EVENT_MESSAGE_DELETED",e.EVENT_MESSAGE_READ="EVENT_MESSAGE_READ",e.EVENT_MESSAGE_DELIVERED="EVENT_MESSAGE_DELIVERED",e.EVENT_MESSAGE_REACTION_UPDATED="EVENT_MESSAGE_REACTION_UPDATED",e.EVENT_MESSAGE_THREADINFO_UPDATED="EVENT_MESSAGE_THREADINFO_UPDATED",e.EVENT_MESSAGE_OFFSET_UPDATED="EVENT_MESSAGE_OFFSET_UPDATED",e.REQUEST_MESSAGE="REQUEST_MESSAGE",e.REQUEST_RESEND_MESSAGE="REQUEST_RESEND_MESSAGE",e.REQUEST_THREADED_MESSAGE="REQUEST_THREADED_MESSAGE",e.REQUEST_MESSAGE_CHANGELOGS="REQUEST_MESSAGE_CHANGELOGS",e.SYNC_MESSAGE_FILL="SYNC_MESSAGE_FILL",e.SYNC_MESSAGE_BACKGROUND="SYNC_MESSAGE_BACKGROUND",e.SYNC_MESSAGE_CHANGELOGS="SYNC_MESSAGE_CHANGELOGS",e.LOCAL_MESSAGE_PENDING_CREATED="LOCAL_MESSAGE_PENDING_CREATED",e.LOCAL_MESSAGE_FAILED="LOCAL_MESSAGE_FAILED",e.LOCAL_MESSAGE_CANCELED="LOCAL_MESSAGE_CANCELED",e.LOCAL_MESSAGE_RESEND_STARTED="LOCAL_MESSAGE_RESEND_STARTED"}(Dt||(Dt={}));var Pt,qt=function(e){return e.startsWith("EVENT_")||e===Dt.SYNC_MESSAGE_FILL||e===Dt.SYNC_MESSAGE_CHANGELOGS},Ft=function(e){function n(t){var n=t.messages,r=t.source,i=e.call(this)||this;return i.messages=n,i.source=r,i}return t(n,e),n}(M),xt=function(e){function n(t){var n=t.messageIds,r=t.source,i=e.call(this)||this;return i.messageIds=n,i.source=r,i}return t(n,e),n}(M),Gt=function(e){function n(t){var n=t.reqId,r=t.source,i=e.call(this)||this;return i.reqId=n,i.source=r,i}return t(n,e),n}(M),Qt=function(e){if(e)switch(e.messageType){case Z.USER:return Lt.payloadify(e);case Z.FILE:return Nt.payloadify(e);case Z.ADMIN:return Ut.payloadify(e)}return null},jt=function(e,t){switch(t.type){case"MESG":return new Lt(e,t);case"FILE":return new Nt(e,t);case"ADMM":case"BRDM":return new Ut(e,t)}return null},zt=function(e){function n(t){var n=t.channelType,r=t.channelUrl,i=t.messageId,s=t.includeMetaArray,a=t.includeReactions,o=t.includeThreadInfo,u=t.includeParentMessageInfo,c=t.includePollDetails,l=e.call(this)||this;return l.method=h.GET,l.path="".concat(xe(n),"/").concat(encodeURIComponent(r),"/messages/").concat(encodeURIComponent(i)),l.params={is_sdk:!0,with_sorted_meta_array:s,include_reactions:a,include_thread_info:o,include_parent_message_info:u,include_poll_details:c},l}return t(n,e),n}(U),Kt=function(e){function r(t,r){var i=e.call(this,t,r)||this;return i.message=r?jt(t,n({},r)):null,i}return t(r,e),r}(P),Bt=function(e){function n(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,s=void 0===i?null:i,a=t.token,o=void 0===a?null:a,u=t.prevResultSize,c=t.nextResultSize,l=t.isInclusive,d=t.reverse,p=t.messageTypeFilter,f=t.customTypesFilter,_=t.senderUserIdsFilter,g=t.replyType,y=t.includeMetaArray,m=t.includeReactions,E=t.parentMessageId,v=t.includeThreadInfo,T=t.includeParentMessageInfo,S=t.showSubchannelMessagesOnly,I=t.includePollDetails,b=e.call(this)||this;return b.method=h.GET,b.path="".concat(xe(n),"/").concat(encodeURIComponent(r),"/messages"),b.params=k({is_sdk:!0,prev_limit:u,next_limit:c,include:l,reverse:d,message_ts:s,message_id:o,message_type:p,custom_types:f,sender_ids:_,include_reply_type:g,with_sorted_meta_array:y,include_reactions:m,parent_message_id:E,include_thread_info:v,include_parent_message_info:T,show_subchannel_message_only:S,include_poll_details:I}),b}return t(n,e),n}(U),Vt=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.messages=n.messages.map((function(e){return jt(t,e)})),r}return t(n,e),n}(P),Ht=function(e){function n(t){var n=t.channelType,r=t.channelUrl,i=t.timestamp,s=t.token,a=t.replyType,o=t.includeMetaArray,u=t.includeReactions,c=t.includeThreadInfo,l=t.includeParentMessageInfo,d=t.includePollDetails,p=e.call(this)||this;return p.method=h.GET,p.path="".concat(xe(n),"/").concat(encodeURIComponent(r),"/messages/changelogs"),p.params={change_ts:i,token:s,with_sorted_meta_array:o,include_reactions:u,include_thread_info:c,include_reply_type:a,include_parent_message_info:l,include_poll_details:d},p}return t(n,e),n}(U),Wt=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.updatedMessages=n.updated.map((function(e){return jt(t,e)})),r.deletedMessagesInfo=n.deleted.map((function(e){return{messageId:e.message_id,deletedAt:e.deleted_at}})),r.hasMore=n.has_more,r.nextToken=n.next,r}return t(n,e),n}(P),Xt={},Yt=function(){function e(e,t){var n=t.sdkState,r=t.dispatcher,i=t.requestQueue,s=t.cacheContext;this._iid=e,this._sdkState=n,this._requestQueue=i,this._dispatcher=r,this._cacheContext=s,this.fileMessageQueue=new Mt(e,{sdkState:n,dispatcher:r,requestQueue:i,cacheContext:s}),Xt[e]=this}return e.of=function(e){return Xt[e]},e.prototype.buildMessageFromSerializedData=function(e){var t=Je(e);switch(t.messageType){case Z.USER:return new Lt(this._iid,Lt.payloadify(t));case Z.FILE:return new Nt(this._iid,Nt.payloadify(t));case Z.ADMIN:return new Ut(this._iid,Ut.payloadify(t))}return null},e.prototype.buildSenderFromSerializedData=function(e){var t=Je(e);return new Tt(this._iid,Tt.payloadify(t))},e.prototype.getMessage=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return t=new zt(e),[4,this._requestQueue.send(t)];case 1:return n=r.sent(),[2,n.as(Kt).message]}}))}))},e.prototype.getMessagesByTimestamp=function(e,t,s,a,o){return void 0===o&&(o=Dt.REQUEST_MESSAGE),r(this,void 0,void 0,(function(){var r,u,c;return i(this,(function(i){switch(i.label){case 0:return r=new Bt(n({channelType:t,channelUrl:e,timestamp:s},a)),[4,this._requestQueue.send(r)];case 1:return u=i.sent(),c=u.as(Vt).messages,this._dispatcher.dispatch(new Ft({messages:c,source:o})),[2,c]}}))}))},e.prototype.getThreadedMessagesByTimestamp=function(e,t,s,a){return void 0===a&&(a=Dt.REQUEST_THREADED_MESSAGE),r(this,void 0,void 0,(function(){var r,o,u,c;return i(this,(function(i){switch(i.label){case 0:return r=new Bt(n(n({channelUrl:e.channelUrl,channelType:e.channelType,timestamp:t},s),{replyType:te.ALL,parentMessageId:e.messageId,includeThreadInfo:!0})),[4,this._requestQueue.send(r)];case 1:return o=i.sent(),u=o.as(Vt).messages,c=u.slice(1),this._dispatcher.dispatch(new Ft({messages:c,source:a})),[2,{parentMessage:u[0],threadedMessages:c}]}}))}))},e.prototype.getMessageChangelogs=function(e,t,s,a,o){return void 0===o&&(o=Dt.REQUEST_MESSAGE_CHANGELOGS),r(this,void 0,void 0,(function(){var r,u,c,l,h,d,p,f;return i(this,(function(i){switch(i.label){case 0:return r=new Ht(k(n({channelType:t,channelUrl:e,timestamp:"number"==typeof s?s:null,token:"string"==typeof s?s:null},a))),[4,this._requestQueue.send(r)];case 1:return u=i.sent(),c=u.as(Wt),l=c.updatedMessages,h=c.deletedMessagesInfo,d=c.hasMore,p=c.nextToken,f=h.map((function(e){return e.messageId})),l.length>0&&this._dispatcher.dispatch(new Ft({messages:l,source:o})),f.length>0&&this._dispatcher.dispatch(new xt({messageIds:f,source:o})),[2,{updatedMessages:l,deletedMessageIds:f,hasMore:d,token:p}]}}))}))},e}(),Jt=function(){function e(){this._onPending=K,this._onFailed=K,this._onSucceeded=K}return e.prototype._trigger=function(e,t){switch(t.requestState){case re.PENDING:this._onPending(t);break;case re.FAILED:case re.CANCELED:this._onFailed(e,t);break;case re.SUCCEEDED:this._onSucceeded(t)}},e.prototype.onPending=function(e){return this._onPending=e,this},e.prototype.onFailed=function(e){return this._onFailed=e,this},e.prototype.onSucceeded=function(e){return this._onSucceeded=e,this},e}();!function(e){e.SCHEDULED="scheduled",e.SENT="sent",e.CANCELED="canceled",e.FAILED="failed"}(Pt||(Pt={}));var Zt,$t=function(e){function n(t,n){var r,i,s,a,o,u,c,l,h=this;(h=e.call(this,t)||this).scheduleId=0,h.scheduledDateTimeString="",h.scheduledTimezone="",h.status=Pt.SCHEDULED,h.channelUrl="",h.channelType=Y.BASE,h.messageType=Z.USER,h.sender=null,h.message="",h.customType="",h.data="",h.mentionType=ee.USERS,h.mentionedUsers=[],h.metaArrays=[],h.translationTargetLanguages=[],h.appleCriticalAlertOptions=null,h.pushNotificationDeliveryOption=ne.DEFAULT,h.createdAt=0,h.updatedAt=0,h.errorCode=0,h.errorMessage="",h.scheduleId=n.scheduled_id,h.scheduledDateTimeString=null!==(r=n.scheduled_dt)&&void 0!==r?r:"",h.scheduledTimezone=null!==(i=n.scheduled_timezone)&&void 0!==i?i:"",h.status=m(Pt,n.status)?n.status:Pt.SCHEDULED,h.channelUrl=n.channel_url,h.channelType=n.channel_type,h.sender=new Tt(h._iid,n.user),h.message=n.message,h.customType=null!==(s=n.custom_type)&&void 0!==s?s:"",h.data=null!==(a=n.data)&&void 0!==a?a:"",h.mentionType=m(ee,n.mention_type)?n.mention_type:null,h.mentionedUsers=n.mentioned_users?n.mentioned_users.map((function(e){return new et(h._iid,e)})):[];for(var d=null!==(o=n.metaarray)&&void 0!==o?o:{},p=null!==(u=n.metaarray_key_order)&&void 0!==u?u:Object.keys(d).sort((function(e,t){return e.localeCompare(t)})),f=0;f<p.length;f++){var _=p[f];h.metaArrays.push(new _t({key:_,value:d[_]||[]}))}return h.translationTargetLanguages=null!==(c=n.translation_target_langs)&&void 0!==c?c:[],h.appleCriticalAlertOptions=n.apple_critical_alert_options?new mt(n.apple_critical_alert_options):null,h.pushNotificationDeliveryOption=m(ne,n.push_option)?n.push_option:ne.DEFAULT,h.status===Pt.FAILED&&n.error&&(h.errorCode=n.error.code,h.errorMessage=n.error.message),h.createdAt=n.created_at,h.updatedAt=null!==(l=n.updated_at)&&void 0!==l?l:0,h}return t(n,e),n}(Ae),en=function(e){function n(t,n){var r=e.call(this,t)||this;r.threadInfo=null,r.targetMessageId=0,r.channelUrl=null,r.channelType=null;var i=n.thread_info,s=n.root_message_id,a=n.channel_url,o=n.channel_type;return i&&y("object",i)&&y("number",s)&&y("string",a)&&y("string",o)&&(r.threadInfo=new ht(t,i),r.targetMessageId=s,r.channelUrl=a,r.channelType=o),r}return t(n,e),n}(Ae),tn=function(){this.channelUrl=null,this.channelType=null,this.messageId=0,this.includeReactions=!1,this.includeMetaArray=!1,this.includeParentMessageInfo=!1,this.includeThreadInfo=!1,this.includePollDetails=!1},nn=function(e){function n(t){var n=e.call(this)||this;if(t)for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);return n}return t(n,e),n.prototype.validate=function(){return y("string",this.channelUrl)&&y("string",this.channelType)&&m(Y,this.channelType)&&y("number",this.messageId)&&y("boolean",this.includeMetaArray)&&y("boolean",this.includeParentMessageInfo)&&y("boolean",this.includeThreadInfo)&&y("boolean",this.includePollDetails)},n}(tn),rn=function(){this.prevResultSize=0,this.nextResultSize=0,this.isInclusive=!1,this.reverse=!1,this.messageTypeFilter=$.ALL,this.customTypesFilter=null,this.senderUserIdsFilter=null,this.replyType=te.NONE,this.includeReactions=!1,this.includeMetaArray=!1,this.includeParentMessageInfo=!1,this.includeThreadInfo=!1,this.showSubchannelMessagesOnly=!1},sn=function(e){function n(t){var n=e.call(this)||this;if(t)for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);return n}return t(n,e),n.prototype.validate=function(){return y("number",this.prevResultSize)&&y("number",this.nextResultSize)&&y("boolean",this.isInclusive)&&y("boolean",this.reverse)&&y("string",this.messageTypeFilter)&&m($,this.messageTypeFilter)&&E("string",this.customTypesFilter,!0)&&E("string",this.senderUserIdsFilter,!0)&&m(te,this.replyType)&&y("boolean",this.includeMetaArray)&&y("boolean",this.includeReactions)&&y("boolean",this.includeParentMessageInfo)&&y("boolean",this.includeThreadInfo)&&y("boolean",this.showSubchannelMessagesOnly)},n}(rn),an=function(){this.replyType=te.NONE,this.includeReactions=!1,this.includeThreadInfo=!1,this.includeMetaArray=!1,this.includeParentMessageInfo=!1,this.includePollDetails=!1},on=function(e){function n(t){var n=e.call(this)||this;if(t)for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);return n}return t(n,e),n.prototype.validate=function(){return m(te,this.replyType)&&y("boolean",this.includeReactions,!0)&&y("boolean",this.includeMetaArray,!0)&&y("boolean",this.includeParentMessageInfo,!0)&&y("boolean",this.includeThreadInfo,!0)&&y("boolean",this.includePollDetails,!0)},n}(an),un=function(){this.data=null,this.customType=null,this.mentionType=ee.USERS,this.mentionedUserIds=[],this.mentionedMessageTemplate=null,this.metaArrays=[],this.parentMessageId=0,this.isReplyToChannel=!1,this.pushNotificationDeliveryOption=null,this.appleCriticalAlertOptions=null,this.reqId=null},cn=function(e){function n(t){var n=e.call(this)||this;if(t)for(var r in t)if(n.hasOwnProperty(r))if("appleCriticalAlertOptions"===r)n[r]=new mt(t[r]);else n[r]=t[r];return n}return t(n,e),n.prototype.validate=function(){return y("string",this.data,!0)&&y("string",this.customType,!0)&&m(ee,this.mentionType)&&E("string",this.mentionedUserIds)&&(y("string",this.mentionedMessageTemplate)||null===this.mentionedMessageTemplate)&&Array.isArray(this.metaArrays)&&this.metaArrays.every((function(e){return e instanceof _t}))&&y("number",this.parentMessageId,!0)&&y("boolean",this.isReplyToChannel)&&(null===this.pushNotificationDeliveryOption||m(ne,this.pushNotificationDeliveryOption))&&(null===this.appleCriticalAlertOptions||this.appleCriticalAlertOptions instanceof mt)&&y("string",this.reqId,!0)},n}(un),ln=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.message=null,t.translationTargetLanguages=null,t}return t(n,e),n}(un),hn=function(e){function n(t){var n=e.call(this)||this;if(t)for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);return n}return t(n,e),n._fromFailedUserMessage=function(e){return new n(k({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.requestedMentionUserIds,mentionedMessageTemplate:e.mentionedMessageTemplate,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,message:e.message,translationTargetLanguages:Object.keys(e.translations),reqId:e.reqId}))},n.prototype.validate=function(){return new cn(this).validate()&&(y("string",this.message)||null===this.message)&&E("string",this.translationTargetLanguages)},n}(ln),dn=function(){this.data=null,this.customType=null,this.mentionType=ee.USERS,this.mentionedUserIds=[],this.mentionedMessageTemplate=null,this.appleCriticalAlertOptions=null},pn=function(e){function n(t){var n=e.call(this)||this;if(t)for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);return n}return t(n,e),n.prototype.validate=function(){return(y("string",this.data)||null===this.data)&&(y("string",this.customType)||null===this.customType)&&m(ee,this.mentionType)&&E("string",this.mentionedUserIds)&&(y("string",this.mentionedMessageTemplate)||null===this.mentionedMessageTemplate)&&(null===this.appleCriticalAlertOptions||this.appleCriticalAlertOptions instanceof mt)},n}(dn),fn=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.message=null,t}return t(n,e),n}(dn),_n=function(e){function n(t){var n=e.call(this)||this;if(t)for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);return n}return t(n,e),n.prototype.validate=function(){return new pn(this).validate()&&(y("string",this.message)||null===this.message)},n}(fn);!function(e){e.FILE="file",e.BLOB="blob",e.BLOB_LIKE_OBJECT="blobLikeObject",e.URL="url"}(Zt||(Zt={}));var gn,yn=function(e){return"undefined"!=typeof window&&"Blob"in window&&"undefined"!=typeof Blob&&e instanceof Blob},mn=function(e){return e===Zt.BLOB||e===Zt.FILE},En=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.file=null,t.fileName=null,t.fileSize=null,t.mimeType=null,t.thumbnailSizes=[],t._fileType=null,t._requireAuth=!1,t}return t(n,e),n}(un),vn=function(e){function n(t){var n=e.call(this)||this;if(t)for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);return n}return t(n,e),Object.defineProperty(n.prototype,"fileUrl",{get:function(){return y("string",this.file)?this.file:null},set:function(e){y("string",e)&&(this.file=e)},enumerable:!1,configurable:!0}),n.prototype._updateFileType=function(){var e,t;t=this.file,"undefined"!=typeof window&&"File"in window&&"undefined"!=typeof File&&t instanceof File?this._fileType=Zt.FILE:yn(this.file)?this._fileType=Zt.BLOB:"object"==typeof(e=this.file)&&"string"==typeof e.name&&"string"==typeof e.uri&&"string"==typeof e.type?this._fileType=Zt.BLOB_LIKE_OBJECT:"string"==typeof this.file&&(this._fileType=Zt.URL)},n._fromFailedFileMessage=function(e,t){return new n({data:e.data,customType:e.customType,mentionType:e.mentionType,mentionedUserIds:e.requestedMentionUserIds,metaArrays:e.metaArrays,parentMessageId:e.parentMessageId,appleCriticalAlertOptions:e.appleCriticalAlertOptions,file:t,fileName:e.name,fileSize:e.size,mimeType:e.type,thumbnailSizes:e.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),reqId:e.reqId})},n.prototype.validate=function(){return new cn(this).validate()&&(T(this.file)||y("string",this.fileUrl))&&(y("string",this.fileName)||null===this.fileName)&&(y("string",this.mimeType)||null===this.mimeType)&&(y("number",this.fileSize)||null===this.fileSize)&&(null===this.thumbnailSizes||this.thumbnailSizes.every((function(e){return y("object",e)&&e.maxWidth>0&&e.maxHeight>0})))},n}(En),Tn=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(dn),Sn=function(e){function n(t){var n=e.call(this)||this;if(t)for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);return n}return t(n,e),n.prototype.validate=function(){return new pn(this).validate()},n}(Tn),In=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.year=null,t.month=null,t.day=null,t.hour=null,t.min=null,t.timezone=null,t}return t(n,e),n}(ln),bn=function(e){function n(t){var n=e.call(this)||this;if(n._scheduledDateTimeString=null,t)for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);return n}return t(n,e),Object.defineProperty(n.prototype,"scheduledDateTimeString",{get:function(){var e;return null!==(e=this._scheduledDateTimeString)&&void 0!==e?e:"".concat(this.year.toString(),"-").concat(("0"+this.month.toString()).substr(-2),"-").concat(("0"+this.day.toString()).substr(-2)," ").concat(("0"+this.hour.toString()).substr(-2),":").concat(("0"+this.min.toString()).substr(-2))},set:function(e){e&&y("string",e)&&(this._scheduledDateTimeString=e)},enumerable:!1,configurable:!0}),n.prototype.setSchedule=function(e){var t,n,r;this.year=e.year,this.month=e.month,this.day=e.day,this.hour=null!==(t=e.hour)&&void 0!==t?t:null,this.min=null!==(n=e.min)&&void 0!==n?n:null,this.timezone=null!==(r=e.timezone)&&void 0!==r?r:null,this._scheduledDateTimeString=null},n.prototype.validate=function(){return new hn(this).validate()&&y("number",this.year)&&y("number",this.month)&&y("number",this.day)&&y("number",this.hour,!0)&&y("number",this.min,!0)&&y("string",this.timezone,!0)},n}(In),On=function(){function e(e,t){var n;this._iid=null,this.limit=20,this._isLoading=!1,this._hasNext=!0,this._token="",this._iid=e,this.limit=null!==(n=t.limit)&&void 0!==n?n:20}return Object.defineProperty(e.prototype,"hasNext",{get:function(){return this._hasNext},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),e.prototype._validate=function(){return y("number",this.limit)&&this.limit>0},e}(),Nn=function(e){function n(t){var n=t.channelCustomType,r=t.keyword,i=t.limit,s=t.reverse,a=t.exactMatch,o=t.channelUrl,u=t.order,c=t.messageTimestampFrom,l=t.messageTimestampTo,d=t.advancedQuery,p=t.targetFields,f=t.nextToken,_=e.call(this)||this;return _.method=h.GET,_.path="".concat(Le,"/messages"),_.params={custom_type:n,query:r,limit:i,reverse:s,exact_match:a,channel_url:o,message_ts_from:c,message_ts_to:l,sort_field:u,advanced_query:d,target_fields:p,after:f},_}return t(n,e),n}(U),An=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.messages=n.results.map((function(e){return jt(t,e)})),r.hasNext=n.has_next,r.nextToken=n.end_cursor,r}return t(n,e),n}(P);!function(e){e.SCORE="score",e.TIMESTAMP="ts"}(gn||(gn={}));var wn=function(e){function s(t,n){var r,i,s,a,o,u,c,l,h,d=this;return(d=e.call(this,t,n)||this).keyword="",d.reverse=!1,d.exactMatch=!1,d.channelUrl="",d.channelCustomType="",d.messageTimestampFrom=null,d.messageTimestampTo=null,d.order=gn.SCORE,d.advancedQuery=!1,d.targetFields=null,d._nextToken="",d.keyword=n.keyword,d.reverse=null!==(r=n.reverse)&&void 0!==r&&r,d.exactMatch=null!==(i=n.exactMatch)&&void 0!==i&&i,d.channelUrl=null!==(s=n.channelUrl)&&void 0!==s?s:"",d.channelCustomType=null!==(a=n.channelCustomType)&&void 0!==a?a:"",d.messageTimestampFrom=null!==(o=n.messageTimestampFrom)&&void 0!==o?o:null,d.messageTimestampTo=null!==(u=n.messageTimestampTo)&&void 0!==u?u:null,d.order=null!==(c=n.order)&&void 0!==c?c:gn.SCORE,d.advancedQuery=null!==(l=n.advancedQuery)&&void 0!==l&&l,d.targetFields=null!==(h=n.targetFields)&&void 0!==h?h:null,d}return t(s,e),s.prototype._validate=function(){return e.prototype._validate.call(this)&&y("string",this.keyword)&&this.keyword.length>0&&y("boolean",this.reverse)&&y("boolean",this.exactMatch)&&y("string",this.channelUrl)&&y("string",this.channelCustomType)&&(y("number",this.messageTimestampFrom)||null===this.messageTimestampFrom)&&(y("number",this.messageTimestampTo)||null===this.messageTimestampTo)&&m(gn,this.order)&&y("boolean",this.advancedQuery)&&E("string",this.targetFields,!0)},s.prototype.next=function(){return r(this,void 0,void 0,(function(){var e,t,r,s,a,o,u;return i(this,(function(i){switch(i.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,e=ot.of(this._iid).requestQueue,t=new Nn(n(n({},this),{nextToken:this._nextToken?this._nextToken:null})),[4,e.send(t)]):[3,2]:[3,5];case 1:return r=i.sent(),s=r.as(An),a=s.messages,o=s.hasNext,u=s.nextToken,this._nextToken=u,this._hasNext=o,this._isLoading=!1,[2,a];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}}))}))},s}(On),Cn=function(e){function n(t,n,r,i){var s=e.call(this,t,i)||this;return s.channelUrl=n,s.channelType=r,s}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&y("string",this.channelUrl)&&m(Y,this.channelType)},n}(On),Rn=function(e){function n(t,n,r,i){var s,a,o,u,c,l,h,d,p,f,_=this;return(_=e.call(this,t,n,r,i)||this).reverse=!1,_.messageTypeFilter=$.ALL,_.customTypesFilter=null,_.senderUserIdsFilter=null,_.replyType=te.NONE,_.includeMetaArray=!1,_.includeReactions=!1,_.includeParentMessageInfo=!1,_.includeThreadInfo=!1,_.showSubchannelMessagesOnly=!1,_._edge=Number.MAX_SAFE_INTEGER,_.reverse=null!==(s=i.reverse)&&void 0!==s&&s,_.messageTypeFilter=null!==(a=i.messageTypeFilter)&&void 0!==a?a:$.ALL,_.customTypesFilter=null!==(o=i.customTypesFilter)&&void 0!==o?o:null,_.senderUserIdsFilter=null!==(u=i.senderUserIdsFilter)&&void 0!==u?u:null,_.replyType=null!==(c=i.replyType)&&void 0!==c?c:te.NONE,_.includeMetaArray=null!==(l=i.includeMetaArray)&&void 0!==l&&l,_.includeReactions=null!==(h=i.includeReactions)&&void 0!==h&&h,_.includeParentMessageInfo=null!==(d=i.includeParentMessageInfo)&&void 0!==d&&d,_.includeThreadInfo=null!==(p=i.includeThreadInfo)&&void 0!==p&&p,_.showSubchannelMessagesOnly=null!==(f=i.showSubchannelMessagesOnly)&&void 0!==f&&f,_}return t(n,e),n.prototype._validate=function(){return e.prototype._validate.call(this)&&y("boolean",this.reverse)&&m($,this.messageTypeFilter)&&m(te,this.replyType)&&E("string",this.customTypesFilter,!0)&&E("string",this.senderUserIdsFilter,!0)&&y("boolean",this.includeMetaArray)&&y("boolean",this.includeReactions)&&y("boolean",this.includeParentMessageInfo)&&y("boolean",this.includeThreadInfo)&&y("boolean",this.showSubchannelMessagesOnly)},n.prototype.load=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return this._validate()?this._isLoading?[3,3]:this._hasNext?(this._isLoading=!0,[4,Yt.of(this._iid).getMessagesByTimestamp(this.channelUrl,this.channelType,this._edge,{prevResultSize:this.limit,nextResultSize:0,isInclusive:!1,reverse:this.reverse,messageTypeFilter:this.messageTypeFilter,customTypesFilter:this.customTypesFilter,replyType:this.replyType,senderUserIdsFilter:this.senderUserIdsFilter,includeReactions:this.includeReactions,includeMetaArray:this.includeMetaArray,includeParentMessageInfo:this.includeParentMessageInfo,includeThreadInfo:this.includeThreadInfo,showSubchannelMessagesOnly:this.showSubchannelMessagesOnly})]):[3,2]:[3,5];case 1:return e=t.sent(),this._edge=Math.min.apply(Math,o([Number.MAX_SAFE_INTEGER],a(e.map((function(e){return e.createdAt}))),!1)),this._hasNext=e.length>=this.limit,this._isLoading=!1,[2,e];case 2:return[2,[]];case 3:throw p.queryInProgress;case 4:return[3,6];case 5:throw p.invalidParameters;case 6:return[2]}}))}))},n}(Cn),Dn=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="message",t}return t(n,e),n.prototype.init=function(t,n){var r=n.sdkState,i=n.dispatcher,s=n.sessionManager,a=n.requestQueue,o=n.logger,u=n.cacheContext;e.prototype.init.call(this,t,{sdkState:r,dispatcher:i,sessionManager:s,requestQueue:a,logger:o,cacheContext:u}),this._manager=new Yt(t,{sdkState:r,dispatcher:i,requestQueue:a,cacheContext:u})},n.prototype.buildMessageFromSerializedData=function(e){return this._manager.buildMessageFromSerializedData(e)},n.prototype.buildSenderFromSerializedData=function(e){return this._manager.buildSenderFromSerializedData(e)},n.prototype.getMessage=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return Ze(e instanceof nn&&e.validate()).throw(p.invalidParameters),[2,this._manager.getMessage(e)]}))}))},n}(ut);export{yn as $,h as A,On as B,L as C,O as D,Dn as E,Y as F,Xe as G,S as H,Ae as I,$ as J,Z as K,$e as L,wn as M,St as N,te as O,kt as P,Lt as Q,J as R,p as S,Nt as T,et as U,ot as V,G as W,Yt as X,vn as Y,hn as Z,t as _,y as a,it as a$,mn as a0,M as a1,_e as a2,Gt as a3,xt as a4,Ft as a5,De as a6,Re as a7,Q as a8,Ye as a9,pt as aA,en as aB,Ge as aC,g as aD,Rn as aE,Tt as aF,Ke as aG,ze as aH,sn as aI,on as aJ,W as aK,_n as aL,Sn as aM,vt as aN,ut as aO,ke as aP,Me as aQ,En as aR,Tn as aS,an as aT,rn as aU,nn as aV,tn as aW,gn as aX,gt as aY,yt as aZ,ft as a_,ie as aa,B as ab,v as ac,re as ad,Dt as ae,u as af,d as ag,Ct as ah,he as ai,R as aj,xe as ak,jt as al,qt as am,pe as an,Cn as ao,_t as ap,mt as aq,$t as ar,Qt as as,Jt as at,bn as au,ee as av,ne as aw,Qe as ax,Ut as ay,je as az,E as b,Pt as b0,In as b1,ht as b2,Ot as b3,bt as b4,It as b5,ln as b6,fn as b7,m as c,r as d,i as e,we as f,k as g,U as h,T as i,n as j,P as k,qe as l,Pe as m,K as n,a as o,s as p,o as q,b as r,Ne as s,Je as t,Ze as u,c as v,fe as w,H as x,I as y,w as z};
