import{d as e,e as n,V as a,aa as r,ab as i,q as s,o,p as u,w as l,z as h,j as c,a2 as d,_ as p,n as m,A as f,a7 as v,g as C,h as g,k as b,a as k,b as M,c as N,B as P,S as T,u as x,aO as D}from"./__bundle-a953c60c.js";export{ae as MessageEventSource}from"./__bundle-a953c60c.js";import{r as j,s as q,G as ee,t as te,T as ne,u as re,v as ie,w as se,x as oe,y as ue,z as le,A as he,S as ce,B as de,C as pe,E as me,F as fe,H as ve,I as _e}from"./__bundle-253902ac.js";export{J as CountPreference,A as GroupChannel,F as GroupChannelChangeLogsParams,K as GroupChannelChangeLogsParamsProperties,H as GroupChannelCountParams,O as GroupChannelCountParamsProperties,I as GroupChannelCreateParams,L as GroupChannelCreateParamsProperties,y as GroupChannelEventContext,t as GroupChannelEventSource,w as GroupChannelFilter,Q as GroupChannelHideParams,R as GroupChannelHideParamsProperties,G as GroupChannelListOrder,E as GroupChannelListQuery,V as GroupChannelSearchField,W as GroupChannelUpdateParams,X as GroupChannelUpdateParamsProperties,Y as HiddenChannelFilter,Z as HiddenState,_ as Member,$ as MemberListOrder,a0 as MemberListQuery,a1 as MemberState,a2 as MemberStateFilter,a3 as MessageCollection,a4 as MessageCollectionInitHandler,a5 as MessageCollectionInitPolicy,a6 as MessageEventContext,a7 as MessageFilter,a8 as MutedState,a9 as OperatorFilter,z as PublicChannelFilter,B as PublicGroupChannelListOrder,aa as QueryType,ab as ReadStatus,S as SuperChannelFilter,ac as UnreadChannelFilter,U as UnreadItemKey}from"./__bundle-253902ac.js";import{B as ye}from"./__bundle-6cc2e604.js";import"./__bundle-459ad47d.js";var Ce,ge={},be=function(){function t(t){var r=t._iid,i=this;this._sync=null,this._metadata=null,this._iid=r;var u,l=a.of(this._iid),h=l.sdkState,c=l.logger;this._metadataKey=(u=h.userId,"sendbird:".concat(u,"@groupchannel/sync.meta"));var d=function(e){return"sendbird:".concat(e,"@groupchannel/sync")}(h.userId);this._sync=new j(d,(function(){return e(i,void 0,void 0,(function(){var e,t,a,r,i;return n(this,(function(n){switch(n.label){case 0:return e={hasNext:!0,nextToken:""},[4,this.loadMetadata()];case 1:return n.sent(),c.debug("channel background sync from",this._metadata.token),this._metadata.completed?[3,4]:[4,q.of(this._iid).getMyGroupChannels(this._metadata.token,{includeEmpty:!0,order:ee.CHRONOLOGICAL},100,te.SYNC_CHANNEL_BACKGROUND)];case 2:return t=n.sent(),a=t.channels,r=t.token,e.hasNext=a.length>=100&&!!r,e.nextToken=r,this._metadata.token=r,(i=this._metadata.range).extends.apply(i,s([],o(a.map((function(e){return e.createdAt}))),!1)),this._metadata.completed=!e.hasNext,c.debug("channel background sync progress",e),[4,this.saveMetadata()];case 3:return n.sent(),[3,5];case 4:e.hasNext=!1,e.nextToken="",n.label=5;case 5:return[2,e]}}))}))}))}return t.of=function(e){if(!ge[e]){var n=ge[e]=new t({_iid:e});a.of(e).dispatcher.on((function(e){if(e instanceof r)if(e.stateType===i.CONNECTED)n.resume();else n.pause()}))}return ge[e]},Object.defineProperty(t.prototype,"range",{get:function(){var e;return null===(e=this._metadata)||void 0===e?void 0:e.range},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"completed",{get:function(){var e;return!!(null===(e=this._metadata)||void 0===e?void 0:e.completed)},enumerable:!1,configurable:!0}),t.prototype.loadMetadata=function(){return e(this,void 0,void 0,(function(){var e;return n(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,a.of(this._iid).cacheContext.store.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={token:e?e.token:"",range:new ne(e?e.range:{top:Number.MAX_SAFE_INTEGER,bottom:0}),completed:!!e&&e.completed},t.label=2;case 2:return[2]}}))}))},t.prototype.saveMetadata=function(){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this._metadata?[4,a.of(this._iid).cacheContext.store.set({key:this._metadataKey,value:this._metadata,generation:1})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.resume=function(){var e,t;a.of(this._iid).logger.debug("channel background sync resume()"),this._sync.start(null!==(t=null===(e=this._metadata)||void 0===e?void 0:e.token)&&void 0!==t?t:"")},t.prototype.pause=function(){a.of(this._iid).logger.debug("channel background sync stop()"),this._sync.stop()},t}(),we={},Fe=function(){function t(t){var r=t._iid,i=this;this._sync=null,this._metadataKey=null,this._metadata=null,this._iid=r;var s,o=a.of(this._iid).sdkState;this._metadataKey=(s=o.userId,"sendbird:".concat(s,"@groupchannel/changelogs.meta"));var u=function(e){return"sendbird:".concat(e,"@groupchannel/changelogs")}(o.userId);this._sync=new j(u,(function(){return e(i,void 0,void 0,(function(){var e,t,a,r;return n(this,(function(n){switch(n.label){case 0:return e={hasNext:!0,nextToken:0},[4,this.loadMetadata()];case 1:return n.sent(),[4,q.of(this._iid).getMyGroupChannelChangeLogs(this._metadata.token,{},te.SYNC_CHANNEL_CHANGELOGS)];case 2:return t=n.sent(),a=t.hasMore,r=t.token,e.hasNext=a,e.nextToken=r,this._metadata.token=r,[4,this.saveMetadata()];case 3:return n.sent(),[2,e]}}))}))}))}return t.of=function(e){if(!we[e]){var n=we[e]=new t({_iid:e});a.of(e).dispatcher.on((function(e){if(e instanceof r)if(e.stateType===i.CONNECTED)n.resume();else n.pause()}))}return we[e]},t.prototype.loadMetadata=function(){return e(this,void 0,void 0,(function(){var e;return n(this,(function(t){switch(t.label){case 0:return this._metadata?[3,2]:[4,a.of(this._iid).cacheContext.store.get(this._metadataKey)];case 1:e=t.sent(),this._metadata={token:e?e.token:""},t.label=2;case 2:return[2]}}))}))},t.prototype.saveMetadata=function(){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return this._metadata?[4,a.of(this._iid).cacheContext.store.set({key:this._metadataKey,value:this._metadata,generation:1})]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},t.prototype.resume=function(){this._sync.start(0)},t.prototype.pause=function(){this._sync.stop()},t}(),ke=function(){function t(e,t){var n=t.filter,r=t.order,i=t.limit,s=this;this.channels=[],this._iid=e,this._key="gcc-".concat(h()),this.filter=null!=n?n:new se,this.order=null!=r?r:ee.LATEST_LAST_MESSAGE,this._hasMore=!0,this._token="",this._limit=null!=i?i:oe,be.of(e).resume(),Fe.of(e).resume();var o=a.of(this._iid).sdkState;q.of(this._iid).subscribeGroupChannelEvent(this._key,{onUpdate:function(e,t){var n=e.filter((function(e){return s.filter.match(e,o.userId)})),a=e.filter((function(e){return!s.filter.match(e,o.userId)})).map((function(e){return e.url}));n.length>0&&s._addChannelsToView(n,t),a.length>0&&s._removeChannelsFromView(a,t)},onRemove:function(e,t){s._removeChannelsFromView(e,t)}})}return Object.defineProperty(t.prototype,"hasMore",{get:function(){return this._hasMore},enumerable:!1,configurable:!0}),t.prototype.setGroupChannelCollectionHandler=function(e){this._handler=e},t.prototype._addChannelsToView=function(t,a,r){var i,s,o=this;void 0===r&&(r=!1);var h=[],c=[];try{for(var d=u(t),p=d.next();!p.done;p=d.next()){var m=p.value,f=re(this.channels,m,this.order),v=f.place;if(f.contains)switch(c.push(m),a){case te.EVENT_CHANNEL_UPDATED:case te.EVENT_MESSAGE_RECEIVED:this.channels.splice(v,1);var _=re(this.channels,m,this.order).place;this.channels.splice(_,0,m);break;default:this.channels[v]=m}else if(v===this.channels.length){var y=be.of(this._iid);(r||y.completed)&&(h.push(m),this.channels.push(m))}else h.push(m),this.channels.splice(v,0,m)}}catch(e){i={error:e}}finally{try{p&&!p.done&&(s=d.return)&&s.call(d)}finally{if(i)throw i.error}}ie(a)&&l((function(){return e(o,void 0,void 0,(function(){var e;return n(this,(function(t){return e=new ue(a),h.length>0&&this._handler.onChannelsAdded(e,h),c.length>0&&this._handler.onChannelsUpdated(e,c),[2]}))}))}))},t.prototype._removeChannelsFromView=function(t,a){var r,i,s=this,o=[],h=function(e){var t=c.channels.findIndex((function(t){return t.url===e}));t>=0&&(o.push(c.channels[t].url),c.channels.splice(t,1))},c=this;try{for(var d=u(t),p=d.next();!p.done;p=d.next()){h(p.value)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}return ie(a)&&o.length>0&&l((function(){return e(s,void 0,void 0,(function(){var e;return n(this,(function(t){return e=new ue(a),this._handler.onChannelsDeleted(e,o),[2]}))}))})),o},t.prototype._getLocalChannels=function(){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,q.of(this._iid).getChannelsFromCache(this._token,this.filter,this.order)];case 1:return[2,e.sent()]}}))}))},t.prototype._getRemoteChannels=function(){return e(this,void 0,void 0,(function(){var e,t,a;return n(this,(function(n){switch(n.label){case 0:return[4,q.of(this._iid).getMyGroupChannels(this._token,c(c({},this.filter),{order:this.order}),this._limit)];case 1:return e=n.sent(),t=e.channels,a=e.token,this._token=a,[2,t]}}))}))},t.prototype.loadMore=function(){return e(this,void 0,void 0,(function(){var t,a=this;return n(this,(function(r){switch(r.label){case 0:return this._hasMore?(t=[],[4,d((function(){return e(a,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,this._getLocalChannels()];case 1:return t=e.sent(),[2]}}))}))}))]):[3,3];case 1:return r.sent(),[4,d((function(){return e(a,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return[4,this._getRemoteChannels()];case 1:return t=e.sent(),[2]}}))}))}))];case 2:return r.sent(),this._addChannelsToView(t,te.REQUEST_CHANNEL,!0),[2,t];case 3:return[2,[]]}}))}))},t.prototype.dispose=function(){q.of(this._iid).unsubscribeGroupChannelEvent(this._key)},t}(),Ge=function(e){function t(t){void 0===t&&(t={});var n=e.call(this)||this;return Object.keys(t).forEach((function(e){n.hasOwnProperty(e)&&(n[e]=t[e])})),n}return p(t,e),t}(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onUserJoined=m,t.onUserLeft=m,t.onUserReceivedInvitation=m,t.onUserDeclinedInvitation=m,t.onChannelHidden=m,t.onUnreadMemberStatusUpdated=m,t.onUndeliveredMemberStatusUpdated=m,t.onTypingStatusUpdated=m,t}return p(t,e),t}(ye)),Me=function(e){function t(t){var n=this,a=t.token,r=t.limit,i=t.order,s=t.includeEmpty,o=t.membershipFilter,u=t.channelNameContainsFilter,l=t.channelUrlsFilter,h=t.customTypesFilter,c=t.customTypeStartsWithFilter,d=t.superChannelFilter,p=t.metadataOrderKeyFilter,m=t.metadataKey,_=t.metadataValues,y=t.metadataValueStartsWith,g=t.includeFrozen,b=t.includeMetaData;return(n=e.call(this)||this).method=f.GET,n.path=v,n.params=C({token:a,limit:r,order:i,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:s,public_mode:le.PUBLIC,public_membership_mode:o,name_contains:u,channel_urls:l,custom_types:h,custom_type_startswith:c,super_mode:d,metadata_order_key:p,metadata_key:m,metadata_values:_,metadata_value_startswith:y,show_frozen:g,show_metadata:b}),n}return p(t,e),t}(g),Se=function(e){function t(t,n){var a=e.call(this,t,n)||this;a.token=null,a.channels=[],a.ts=null;var r=n.next,i=n.channels,s=n.ts;return a.token=r,i&&i.length>0&&(a.channels=i.map((function(e){return e.ts=s,new he(t,e)}))),a.ts="number"==typeof s?s:null,a}return p(t,e),t}(b);!function(e){e.ALL="all",e.JOINED="joined"}(Ce||(Ce={}));var Ee=function(t){function r(e,n){var a,r,i,s,o,u,l,h,c,d,p,m,f,v,_=this;return(_=t.call(this,e,n)||this).includeEmpty=!1,_.includeFrozen=!0,_.includeMetaData=!0,_.channelUrlsFilter=null,_.customTypesFilter=null,_.customTypeStartsWithFilter=null,_.nicknameContainsFilter=null,_.channelNameContainsFilter=null,_.membershipFilter=Ce.ALL,_.superChannelFilter=ce.ALL,_.metadataKey=null,_.metadataValues=null,_.metadataOrderKeyFilter=null,_.metadataValueStartsWith=null,_.order=de.CHRONOLOGICAL,_.includeEmpty=null!==(a=n.includeEmpty)&&void 0!==a&&a,_.includeFrozen=null===(r=n.includeFrozen)||void 0===r||r,_.includeMetaData=null===(i=n.includeMetaData)||void 0===i||i,_.channelUrlsFilter=null!==(s=n.channelUrlsFilter)&&void 0!==s?s:null,_.customTypesFilter=null!==(o=n.customTypesFilter)&&void 0!==o?o:null,_.customTypeStartsWithFilter=null!==(u=n.customTypeStartsWithFilter)&&void 0!==u?u:null,_.channelNameContainsFilter=null!==(l=n.channelNameContainsFilter)&&void 0!==l?l:null,_.membershipFilter=null!==(h=n.membershipFilter)&&void 0!==h?h:Ce.ALL,_.superChannelFilter=null!==(c=n.superChannelFilter)&&void 0!==c?c:ce.ALL,_.metadataKey=null!==(d=n.metadataKey)&&void 0!==d?d:null,_.metadataValues=null!==(p=n.metadataValues)&&void 0!==p?p:null,_.metadataOrderKeyFilter=null!==(m=n.metadataOrderKeyFilter)&&void 0!==m?m:null,_.metadataValueStartsWith=null!==(f=n.metadataValueStartsWith)&&void 0!==f?f:null,_.order=null!==(v=n.order)&&void 0!==v?v:de.CHRONOLOGICAL,_}return p(r,t),r.prototype._validate=function(){return t.prototype._validate.call(this)&&k("boolean",this.includeEmpty)&&k("boolean",this.includeFrozen)&&k("boolean",this.includeMetaData)&&k("string",this.channelNameContainsFilter,!0)&&M("string",this.channelUrlsFilter,!0)&&M("string",this.customTypesFilter,!0)&&k("string",this.customTypeStartsWithFilter,!0)&&N(Ce,this.membershipFilter)&&N(ce,this.superChannelFilter)&&N(de,this.order)&&k("string",this.metadataOrderKeyFilter,!0)&&k("string",this.metadataKey,!0)&&M("string",this.metadataValues,!0)&&k("string",this.metadataValueStartsWith,!0)},r.prototype.next=function(){return e(this,void 0,void 0,(function(){var e,t,r,i,s,o,u,l,h;return n(this,(function(n){switch(n.label){case 0:return this._validate()?this._isLoading?[3,3]:(e=[],this._hasNext?(this._isLoading=!0,t=a.of(this._iid),r=t.requestQueue,i=t.dispatcher,s=new Me(c(c({},this),{token:this._token})),[4,r.send(s)]):[3,2]):[3,5];case 1:return o=n.sent(),u=o.as(Se),l=u.channels,h=u.token,this._token=h,this._hasNext=!!h,i.dispatch(new pe({channels:l,source:te.REQUEST_CHANNEL})),this._isLoading=!1,[2,l];case 2:return[2,e];case 3:throw T.queryInProgress;case 4:return[3,6];case 5:throw T.invalidParameters;case 6:return[2]}}))}))},r}(P),Le=function(t){function a(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="groupChannel",e}return p(a,t),a.prototype.init=function(e,n){var a=n.sdkState,r=n.dispatcher,i=n.sessionManager,s=n.requestQueue,o=n.logger,u=n.cacheContext;t.prototype.init.call(this,e,{sdkState:a,dispatcher:r,sessionManager:i,requestQueue:s,logger:o,cacheContext:u}),this._manager=new q(e,{sdkState:a,cacheContext:u,dispatcher:r,sessionManager:i,requestQueue:s,logger:o})},a.prototype.createGroupChannelCollection=function(e){return void 0===e&&(e={}),new ke(this._iid,e)},a.prototype.createMyGroupChannelListQuery=function(e){return void 0===e&&(e={}),new me(this._iid,e)},a.prototype.createPublicGroupChannelListQuery=function(e){return void 0===e&&(e={}),new Ee(this._iid,e)},a.prototype.addGroupChannelHandler=function(e,t){x(k("string",e)&&t instanceof Ge).throw(T.invalidParameters),this._manager.addHandler(e,t)},a.prototype.removeGroupChannelHandler=function(e){x(k("string",e)).throw(T.invalidParameters),this._manager.removeHandler(e)},a.prototype.removeAllGroupChannelHandlers=function(){this._manager.clearHandler()},a.prototype.buildGroupChannelFromSerializedData=function(e){return this._manager.buildGroupChannelFromSerializedData(e)},a.prototype.buildGroupChannelListQueryFromSerializedData=function(e){return this._manager.buildGroupChannelListQueryFromSerializedData(e)},a.prototype.buildMemberFromSerializedData=function(e){return this._manager.buildMemberFromSerializedData(e)},a.prototype.getChannel=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return x(k("string",t)).throw(T.invalidParameters),[2,this._manager.getChannel(t)]}))}))},a.prototype.getChannelWithoutCache=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return x(k("string",t)).throw(T.invalidParameters),[2,this._manager.getChannelWithoutCache(t)]}))}))},a.prototype.getMyGroupChannelChangeLogsByToken=function(t,a){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return x(k("string",t)&&a instanceof fe&&a.validate()).throw(T.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(t,a)];case 1:return[2,e.sent()]}}))}))},a.prototype.getMyGroupChannelChangeLogsByTimestamp=function(t,a){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return x(k("number",t)&&a instanceof fe&&a.validate()).throw(T.invalidParameters),[4,this._manager.getMyGroupChannelChangeLogs(t,a)];case 1:return[2,e.sent()]}}))}))},a.prototype.getGroupChannelCount=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return x(t instanceof ve&&t.validate()).throw(T.invalidParameters),[2,this._manager.getGroupChannelCount(t)]}))}))},a.prototype.createChannel=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return x(t instanceof _e&&t.validate()).throw(T.invalidParameters),[2,this._manager.createChannel(t)]}))}))},a.prototype.createDistinctChannelIfNotExist=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return x(t instanceof _e&&t.validate()).throw(T.invalidParameters),t&&(t.isDistinct=!0),[2,this.createChannel(t)]}))}))},a.prototype.createChannelWithUserIds=function(t,a,r,i,s,o){return void 0===a&&(a=!1),void 0===r&&(r=null),void 0===i&&(i=null),void 0===s&&(s=""),void 0===o&&(o=""),e(this,void 0,void 0,(function(){var e;return n(this,(function(n){return(e=new _e).addUserIds(t),e.isDistinct=a,e.name=r,e.data=s,e.customType=o,"string"==typeof i?e.coverUrl=i:e.coverImage=i,[2,this.createChannel(e)]}))}))},a.prototype.markAsReadAll=function(){return e(this,void 0,void 0,(function(){return n(this,(function(e){return this._manager.markAsReadAll(),[2]}))}))},a.prototype.markAsReadWithChannelUrls=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){return x(M("string",t)).throw(T.invalidParameters),this._manager.markAsReadWithChannelUrls(t),[2]}))}))},a.prototype.markAsDelivered=function(t){return e(this,void 0,void 0,(function(){return n(this,(function(e){switch(e.label){case 0:return x(k("string",t)).throw(T.invalidParameters),[4,this.getChannel(t)];case 1:return[4,e.sent().markAsDelivered()];case 2:return e.sent(),[2]}}))}))},a}(D);export{ke as GroupChannelCollection,Ge as GroupChannelHandler,Le as GroupChannelModule,Ee as PublicGroupChannelListQuery};
